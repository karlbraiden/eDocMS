/*
** Annotator v2.0.0-dev-41928d6
** https://github.com/okfn/annotator/
**
** Copyright 2014, the Annotator project contributors.
** Dual licensed under the MIT and GPLv3 licenses.
** https://github.com/okfn/annotator/blob/master/LICENSE
**
** Built at: 2014-04-11 02:53:43Z
*/
!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self);var o=n;o=o.Annotator||(o.Annotator={}),o=o.Plugin||(o.Plugin={}),o.Tags=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"4hR4NO":[function(_dereq_,module,exports){
(function (global){
var Annotator, self, _ref;

if (typeof self !== "undefined" && self !== null) {
  self = self;
}

if (typeof global !== "undefined" && global !== null) {
  if (self == null) {
    self = global;
  }
}

if (typeof window !== "undefined" && window !== null) {
  if (self == null) {
    self = window;
  }
}

Annotator = self != null ? self.Annotator : void 0;

if (Annotator == null) {
  Annotator = (self != null ? (_ref = self.define) != null ? _ref.amd : void 0 : void 0) ? self != null ? self.require('annotator') : void 0 : void 0;
}

if (typeof Annotator !== 'function') {
  throw new Error("Could not find Annotator! In a webpage context, please ensure that the Annotator script tag is loaded before any plugins.");
}

module.exports = Annotator;


}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],"annotator":[function(_dereq_,module,exports){
module.exports=_dereq_('4hR4NO');
},{}],3:[function(_dereq_,module,exports){
var $, Annotator, Tags,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Annotator = _dereq_('annotator');

$ = Annotator.Util.$;

Tags = (function(_super) {
  __extends(Tags, _super);

  function Tags() {
    this.setAnnotationTags = __bind(this.setAnnotationTags, this);
    this.updateField = __bind(this.updateField, this);
    return Tags.__super__.constructor.apply(this, arguments);
  }

  Tags.prototype.options = {
    parseTags: function(string) {
      var tags;
      string = $.trim(string);
      tags = [];
      if (string) {
        tags = string.split(/\s+/);
      }
      return tags;
    },
    stringifyTags: function(array) {
      return array.join(" ");
    }
  };

  Tags.prototype.field = null;

  Tags.prototype.input = null;

  Tags.prototype.pluginInit = function() {
    if (!Annotator.supported()) {
      return;
    }
    this.field = this.annotator.editor.addField({
      label: Annotator._t('Add some tags here') + '\u2026',
      load: this.updateField,
      submit: this.setAnnotationTags
    });
    this.annotator.viewer.addField({
      load: this.updateViewer
    });
    if (this.annotator.plugins.Filter) {
      this.annotator.plugins.Filter.addFilter({
        label: Annotator._t('Tag'),
        property: 'tags',
        isFiltered: Tags.filterCallback
      });
    }
    return this.input = $(this.field).find(':input');
  };

  Tags.prototype.parseTags = function(string) {
    return this.options.parseTags(string);
  };

  Tags.prototype.stringifyTags = function(array) {
    return this.options.stringifyTags(array);
  };

  Tags.prototype.updateField = function(field, annotation) {
    var value;
    value = '';
    if (annotation.tags) {
      value = this.stringifyTags(annotation.tags);
    }
    return this.input.val(value);
  };

  Tags.prototype.setAnnotationTags = function(field, annotation) {
    return annotation.tags = this.parseTags(this.input.val());
  };

  Tags.prototype.updateViewer = function(field, annotation) {
    field = $(field);
    if (annotation.tags && $.isArray(annotation.tags) && annotation.tags.length) {
      return field.addClass('annotator-tags').html(function() {
        var string;
        return string = $.map(annotation.tags, function(tag) {
          return '<span class="annotator-tag">' + Annotator.Util.escape(tag) + '</span>';
        }).join(' ');
      });
    } else {
      return field.remove();
    }
  };

  return Tags;

})(Annotator.Plugin);

Tags.filterCallback = function(input, tags) {
  var keyword, keywords, matches, tag, _i, _j, _len, _len1;
  if (tags == null) {
    tags = [];
  }
  matches = 0;
  keywords = [];
  if (input) {
    keywords = input.split(/\s+/g);
    for (_i = 0, _len = keywords.length; _i < _len; _i++) {
      keyword = keywords[_i];
      if (tags.length) {
        for (_j = 0, _len1 = tags.length; _j < _len1; _j++) {
          tag = tags[_j];
          if (tag.indexOf(keyword) !== -1) {
            matches += 1;
          }
        }
      }
    }
  }
  return matches === keywords.length;
};

Annotator.Plugin.register('Tags', Tags);

module.exports = Tags;


},{}]},{},[3])

(3)
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGtnL2Fubm90YXRvci50YWdzLmpzIiwic291cmNlcyI6WyIuLi9ub2RlX21vZHVsZXMvYnJvd3NlcmlmeS9ub2RlX21vZHVsZXMvYnJvd3Nlci1wYWNrL19wcmVsdWRlLmpzIiwibmFtZXNwYWNlLmNvZmZlZSIsInBsdWdpbi90YWdzLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUE7QUNLQTs7O1NBQU8sSUFBUDs7O0FBQ0E7O1dBQVE7R0FBUjtDQURBOztBQUVBOztXQUFRO0dBQVI7Q0FGQTs7Ozs7RUFNQSxzQkFBYTtDQU5iOztBQVVBO0FBQ0UsUUFBVSxVQUFNLG9CQURsQjtDQVZBOzs7Ozs7Ozs7O0FDTEE7Ozs7O1lBQVksUUFBUSxXQUFSLENBQVo7O0NBQ0EsR0FBSSxTQUFTLENBQUMsSUFBSSxDQUFDLENBRG5COzs7QUFRRTs7Ozs7Ozs7MkJBSUU7ZUFBVyxTQUFDLE1BQUQ7QUFDVDtlQUFTLENBQUMsQ0FBQyxJQUFGLENBQU8sTUFBUCxDQUFUO01BRUEsT0FBTyxFQUZQO0FBR0EsVUFBOEIsTUFBOUI7ZUFBTyxNQUFNLENBQUMsS0FBUCxDQUFhLEtBQWIsQ0FBUDtPQUhBO2FBSUEsS0FMUztLQUFYO0lBU0EsZUFBZSxTQUFDLEtBQUQ7YUFDYixLQUFLLENBQUMsSUFBTixDQUFXLEdBQVgsRUFEYTtLQVRmO0dBSkY7O2lCQWtCQSxRQUFPLElBbEJQOztpQkFzQkEsUUFBTyxJQXRCUDs7aUJBNkJBLGFBQVk7QUFDVixrQkFBdUIsQ0FBQyxTQUFWLEVBQWQ7OztJQUVBLElBQUMsTUFBRCxHQUFTLElBQUMsVUFBUyxDQUFDLE1BQU0sQ0FBQyxRQUFsQixDQUEyQjtNQUNsQyxPQUFPLFNBQVMsQ0FBQyxFQUFWLENBQWEsb0JBQWIsSUFBcUMsUUFEVjtNQUVsQyxNQUFNLElBQUksQ0FBQyxXQUZ1QjtNQUdsQyxRQUFRLElBQUksQ0FBQyxpQkFIcUI7S0FBM0IsQ0FGVDtJQVFBLElBQUMsVUFBUyxDQUFDLE1BQU0sQ0FBQyxRQUFsQixDQUEyQjtNQUN6QixNQUFNLElBQUksQ0FBQyxZQURjO0tBQTNCLENBUkE7QUFhQSxRQUFHLElBQUMsVUFBUyxDQUFDLE9BQU8sQ0FBQyxNQUF0QjtBQUNFLFVBQUMsVUFBUyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsU0FBMUIsQ0FDRTtlQUFPLFNBQVMsQ0FBQyxFQUFWLENBQWEsS0FBYixDQUFQO1FBQ0EsVUFBVSxNQURWO1FBRUEsWUFBWSxJQUFJLENBQUMsY0FGakI7T0FERixFQURGO0tBYkE7V0FtQkEsSUFBQyxNQUFELEdBQVMsRUFBRSxJQUFDLE1BQUgsQ0FBUyxDQUFDLElBQVYsQ0FBZSxRQUFmLEVBcEJDO0dBN0JaOztpQkE2REEsWUFBVyxTQUFDLE1BQUQ7V0FDVCxJQUFDLFFBQU8sQ0FBQyxTQUFULENBQW1CLE1BQW5CLEVBRFM7R0E3RFg7O2lCQTBFQSxnQkFBZSxTQUFDLEtBQUQ7V0FDYixJQUFDLFFBQU8sQ0FBQyxhQUFULENBQXVCLEtBQXZCLEVBRGE7R0ExRWY7O2lCQTBGQSxjQUFhLFNBQUMsS0FBRCxFQUFRLFVBQVI7QUFDWDtZQUFRLEVBQVI7QUFDQSxRQUErQyxVQUFVLENBQUMsSUFBMUQ7Y0FBUSxJQUFJLENBQUMsYUFBTCxDQUFtQixVQUFVLENBQUMsSUFBOUIsQ0FBUjtLQURBO1dBR0EsSUFBQyxNQUFLLENBQUMsR0FBUCxDQUFXLEtBQVgsRUFKVztHQTFGYjs7aUJBK0dBLG9CQUFtQixTQUFDLEtBQUQsRUFBUSxVQUFSO1dBQ2pCLFVBQVUsQ0FBQyxJQUFYLEdBQWtCLElBQUksQ0FBQyxTQUFMLENBQWUsSUFBQyxNQUFLLENBQUMsR0FBUCxFQUFmLEVBREQ7R0EvR25COztpQkErSEEsZUFBYyxTQUFDLEtBQUQsRUFBUSxVQUFSO0FBQ1osWUFBUSxFQUFFLEtBQUYsQ0FBUjtBQUVBLFFBQUcsVUFBVSxDQUFDLElBQVgsSUFBb0IsQ0FBQyxDQUFDLE9BQUYsQ0FBVSxVQUFVLENBQUMsSUFBckIsQ0FBcEIsSUFBbUQsVUFBVSxDQUFDLElBQUksQ0FBQyxNQUF0RTthQUNFLEtBQUssQ0FBQyxRQUFOLENBQWUsZ0JBQWYsQ0FBZ0MsQ0FBQyxJQUFqQyxDQUFzQztBQUNwQzt3QkFBUyxDQUFDLENBQUMsR0FBRixDQUFNLFVBQVUsQ0FBQyxJQUFqQixFQUFzQixTQUFDLEdBQUQ7aUJBQzdCLGlDQUNBLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBZixDQUFzQixHQUF0QixDQURBLEdBRUEsVUFINkI7U0FBdEIsQ0FJUixDQUFDLElBSk8sQ0FJRixHQUpFLEVBRDJCO09BQXRDLEVBREY7O2FBU0UsS0FBSyxDQUFDLE1BQU4sR0FURjtLQUhZO0dBL0hkOzs7O0dBRmlCLFNBQVMsQ0FBQyxPQU43Qjs7SUFrS0ksQ0FBQyxjQUFMLEdBQXNCLFNBQUMsS0FBRCxFQUFRLElBQVI7QUFDcEI7O0lBRDRCLE9BQU87R0FDbkM7WUFBVyxDQUFYO0VBQ0EsV0FBVyxFQURYO0FBRUEsTUFBRyxLQUFIO0FBQ0UsZUFBVyxLQUFLLENBQUMsS0FBTixDQUFZLE1BQVosQ0FBWDtBQUNBOztVQUE2QixJQUFJLENBQUM7QUFDaEM7O2NBQWtDLEdBQUcsQ0FBQyxPQUFKLENBQVksT0FBWixNQUF3QjtBQUExRCx1QkFBVyxDQUFYOzs7T0FERjtLQUZGO0dBRkE7U0FPQSxZQUFXLFFBQVEsQ0FBQyxPQVJBO0NBbEt0Qjs7U0E0S1MsQ0FBQyxNQUFNLENBQUMsUUFBakIsQ0FBMEIsTUFBMUIsRUFBa0MsSUFBbEMsQ0E1S0E7O01BOEtNLENBQUMsT0FBUCxHQUFpQixJQTlLakIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3Rocm93IG5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIil9dmFyIGY9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGYuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sZixmLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIiMgSW4gb3JkZXIgdG8gYnVpbGQgcG9ydGFibGUgZXh0ZW5zaW9uIGJ1bmRsZXMgdGhhdCBjYW4gYmUgdXNlZCB3aXRoIEFNRCBhbmRcbiMgc2NyaXB0IGNvbmNhdGVuYXRpb24gcGx1Z2lucyBhcmUgYnVpbHQgd2l0aCB0aGlzIG1vZHVsZSBhcyAnYW5ub3RhdG9yJy5cblxuIyBBbm5vdGF0b3Igd2lsbCBleHBvcnQgaXRzZWxmIGdsb2JhbGx5IHdoZW4gdGhlIGJ1aWx0IFVNRCBtb2R1bGVzIGFyZSB1c2VkIGluXG4jIGEgbGVnYWN5IGVudmlyb25tZW50IG9mIHNpbXBsZSBzY3JpcHQgY29uY2F0ZW5hdGlvbi5cbnNlbGYgPSBzZWxmIGlmIHNlbGY/XG5zZWxmID89IGdsb2JhbCBpZiBnbG9iYWw/XG5zZWxmID89IHdpbmRvdyBpZiB3aW5kb3c/XG5Bbm5vdGF0b3IgPSBzZWxmPy5Bbm5vdGF0b3JcblxuIyBJbiBhIHB1cmUgQU1EIGVudmlyb25tZW50LCBBbm5vdGF0b3IgbWF5IG5vdCBiZSBleHBvcnRlZCBnbG9iYWxseS5cbkFubm90YXRvciA/PSBpZiBzZWxmPy5kZWZpbmU/LmFtZCB0aGVuIHNlbGY/LnJlcXVpcmUoJ2Fubm90YXRvcicpXG5cbiMgSWYgd2UgaGF2ZW4ndCBzdWNjZXNzZnVsbHkgbG9hZGVkIEFubm90YXRvciBieSB0aGlzIHBvaW50LCB0aGVyZSdzIG5vIHBvaW50IGluXG4jIGdvaW5nIG9uIHRvIGxvYWQgdGhlIHBsdWdpbiwgc28gdGhyb3cgYSBmYXRhbCBlcnJvci5cbmlmIHR5cGVvZiBBbm5vdGF0b3IgaXNudCAnZnVuY3Rpb24nXG4gIHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBmaW5kIEFubm90YXRvciEgSW4gYSB3ZWJwYWdlIGNvbnRleHQsIHBsZWFzZSBlbnN1cmVcbiAgICAgICAgICAgICAgICAgICB0aGF0IHRoZSBBbm5vdGF0b3Igc2NyaXB0IHRhZyBpcyBsb2FkZWQgYmVmb3JlIGFueSBwbHVnaW5zLlwiKVxuXG4jIE5vdGU6IHdoZW4gd29ya2luZyBpbiBhIENvbW1vbkpTIGVudmlyb25tZW50IGFuZCBidW5kbGluZyByZXF1aXJlbWVudHMgaW50b1xuIyBhcHBsaWNhdGlvbnMgdGhlbiByZXF1aXJlIGNhbGxzIHNob3VsZCByZWZlciB0byBtb2R1bGVzIGZyb20gdGhlIG5wbSBsaWJcbiMgZGlyZWN0b3J5IG9mIGFubm90YXRvciBwYWNrYWdlIGFuZCBhdm9pZCB0aGlzIGFsdG9nZXRoZXIuXG5tb2R1bGUuZXhwb3J0cyA9IEFubm90YXRvclxuIiwiQW5ub3RhdG9yID0gcmVxdWlyZSgnYW5ub3RhdG9yJylcbiQgPSBBbm5vdGF0b3IuVXRpbC4kXG5cblxuIyBQdWJsaWM6IFRhZ3MgcGx1Z2luIGFsbG93cyB1c2VycyB0byB0YWcgdGhpZXIgYW5ub3RhdGlvbnMgd2l0aCBtZXRhZGF0YVxuIyBzdG9yZWQgaW4gYW4gQXJyYXkgb24gdGhlIGFubm90YXRpb24gYXMgdGFncy5cbmNsYXNzIFRhZ3MgZXh0ZW5kcyBBbm5vdGF0b3IuUGx1Z2luXG5cbiAgb3B0aW9uczpcbiAgICAjIENvbmZpZ3VyYWJsZSBmdW5jdGlvbiB3aGljaCBhY2NlcHRzIGEgc3RyaW5nICh0aGUgY29udGVudHMpXG4gICAgIyBvZiB0aGUgdGFncyBpbnB1dCBhcyBhbiBhcmd1bWVudCwgYW5kIHJldHVybnMgYW4gYXJyYXkgb2ZcbiAgICAjIHRhZ3MuXG4gICAgcGFyc2VUYWdzOiAoc3RyaW5nKSAtPlxuICAgICAgc3RyaW5nID0gJC50cmltKHN0cmluZylcblxuICAgICAgdGFncyA9IFtdXG4gICAgICB0YWdzID0gc3RyaW5nLnNwbGl0KC9cXHMrLykgaWYgc3RyaW5nXG4gICAgICB0YWdzXG5cbiAgICAjIENvbmZpZ3VyYWJsZSBmdW5jdGlvbiB3aGljaCBhY2NlcHRzIGFuIGFycmF5IG9mIHRhZ3MgYW5kXG4gICAgIyByZXR1cm5zIGEgc3RyaW5nIHdoaWNoIHdpbGwgYmUgdXNlZCB0byBmaWxsIHRoZSB0YWdzIGlucHV0LlxuICAgIHN0cmluZ2lmeVRhZ3M6IChhcnJheSkgLT5cbiAgICAgIGFycmF5LmpvaW4oXCIgXCIpXG5cbiAgIyBUaGUgZmllbGQgZWxlbWVudCBhZGRlZCB0byB0aGUgQW5ub3RhdG9yLkVkaXRvciB3cmFwcGVkIGluIGpRdWVyeS4gQ2FjaGVkIHRvXG4gICMgc2F2ZSBoYXZpbmcgdG8gcmVjcmVhdGUgaXQgZXZlcnl0aW1lIHRoZSBlZGl0b3IgaXMgZGlzcGxheWVkLlxuICBmaWVsZDogbnVsbFxuXG4gICMgVGhlIGlucHV0IGVsZW1lbnQgYWRkZWQgdG8gdGhlIEFubm90YXRvci5FZGl0b3Igd3JhcHBlZCBpbiBqUXVlcnkuIENhY2hlZCB0b1xuICAjIHNhdmUgaGF2aW5nIHRvIHJlY3JlYXRlIGl0IGV2ZXJ5dGltZSB0aGUgZWRpdG9yIGlzIGRpc3BsYXllZC5cbiAgaW5wdXQ6IG51bGxcblxuICAjIFB1YmxpYzogSW5pdGlhbGlzZXMgdGhlIHBsdWdpbiBhbmQgYWRkcyBjdXN0b20gZmllbGRzIHRvIGJvdGggdGhlXG4gICMgYW5ub3RhdG9yIHZpZXdlciBhbmQgZWRpdG9yLiBUaGUgcGx1Z2luIGFsc28gY2hlY2tzIGlmIHRoZSBhbm5vdGF0b3IgaXNcbiAgIyBzdXBwb3J0ZWQgYnkgdGhlIGN1cnJlbnQgYnJvd3Nlci5cbiAgI1xuICAjIFJldHVybnMgbm90aGluZy5cbiAgcGx1Z2luSW5pdDogLT5cbiAgICByZXR1cm4gdW5sZXNzIEFubm90YXRvci5zdXBwb3J0ZWQoKVxuXG4gICAgQGZpZWxkID0gQGFubm90YXRvci5lZGl0b3IuYWRkRmllbGQoe1xuICAgICAgbGFiZWw6IEFubm90YXRvci5fdCgnQWRkIHNvbWUgdGFncyBoZXJlJykgKyAnXFx1MjAyNidcbiAgICAgIGxvYWQ6IHRoaXMudXBkYXRlRmllbGRcbiAgICAgIHN1Ym1pdDogdGhpcy5zZXRBbm5vdGF0aW9uVGFnc1xuICAgIH0pXG5cbiAgICBAYW5ub3RhdG9yLnZpZXdlci5hZGRGaWVsZCh7XG4gICAgICBsb2FkOiB0aGlzLnVwZGF0ZVZpZXdlclxuICAgIH0pXG5cbiAgICAjIEFkZCBhIGZpbHRlciB0byB0aGUgRmlsdGVyIHBsdWdpbiBpZiBsb2FkZWQuXG4gICAgaWYgQGFubm90YXRvci5wbHVnaW5zLkZpbHRlclxuICAgICAgQGFubm90YXRvci5wbHVnaW5zLkZpbHRlci5hZGRGaWx0ZXJcbiAgICAgICAgbGFiZWw6IEFubm90YXRvci5fdCgnVGFnJylcbiAgICAgICAgcHJvcGVydHk6ICd0YWdzJ1xuICAgICAgICBpc0ZpbHRlcmVkOiBUYWdzLmZpbHRlckNhbGxiYWNrXG5cbiAgICBAaW5wdXQgPSAkKEBmaWVsZCkuZmluZCgnOmlucHV0JylcblxuICAjIFB1YmxpYzogRXh0cmFjdHMgdGFncyBmcm9tIHRoZSBwcm92aWRlZCBTdHJpbmcuXG4gICNcbiAgIyBzdHJpbmcgLSBBIFN0cmluZyBvZiB0YWdzIHNlcGVyYXRlZCBieSBzcGFjZXMuXG4gICNcbiAgIyBFeGFtcGxlc1xuICAjXG4gICMgICBwbHVnaW4ucGFyc2VUYWdzKCdjYWtlIGNob2NvbGF0ZSBjYWJiYWdlJylcbiAgIyAgICMgPT4gWydjYWtlJywgJ2Nob2NvbGF0ZScsICdjYWJiYWdlJ11cbiAgI1xuICAjIFJldHVybnMgQXJyYXkgb2YgcGFyc2VkIHRhZ3MuXG4gIHBhcnNlVGFnczogKHN0cmluZykgLT5cbiAgICBAb3B0aW9ucy5wYXJzZVRhZ3Moc3RyaW5nKVxuXG4gICMgUHVibGljOiBUYWtlcyBhbiBhcnJheSBvZiB0YWdzIGFuZCBzZXJpYWxpc2VzIHRoZW0gaW50byBhIFN0cmluZy5cbiAgI1xuICAjIGFycmF5IC0gQW4gQXJyYXkgb2YgdGFncy5cbiAgI1xuICAjIEV4YW1wbGVzXG4gICNcbiAgIyAgIHBsdWdpbi5zdHJpbmdpZnlUYWdzKFsnY2FrZScsICdjaG9jb2xhdGUnLCAnY2FiYmFnZSddKVxuICAjICAgIyA9PiAnY2FrZSBjaG9jb2xhdGUgY2FiYmFnZSdcbiAgI1xuICAjIFJldHVybnMgQXJyYXkgb2YgcGFyc2VkIHRhZ3MuXG4gIHN0cmluZ2lmeVRhZ3M6IChhcnJheSkgLT5cbiAgICBAb3B0aW9ucy5zdHJpbmdpZnlUYWdzKGFycmF5KVxuXG4gICMgQW5ub3RhdG9yLkVkaXRvciBjYWxsYmFjayBmdW5jdGlvbi4gVXBkYXRlcyB0aGUgQGlucHV0IGZpZWxkIHdpdGggdGhlXG4gICMgdGFncyBhdHRhY2hlZCB0byB0aGUgcHJvdmlkZWQgYW5ub3RhdGlvbi5cbiAgI1xuICAjIGZpZWxkICAgICAgLSBUaGUgdGFncyBmaWVsZCBFbGVtZW50IGNvbnRhaW5pbmcgdGhlIGlucHV0IEVsZW1lbnQuXG4gICMgYW5ub3RhdGlvbiAtIEFuIGFubm90YXRpb24gb2JqZWN0IHRvIGJlIGVkaXRlZC5cbiAgI1xuICAjIEV4YW1wbGVzXG4gICNcbiAgIyAgIGZpZWxkID0gJCgnPGxpPjxpbnB1dCAvPjwvbGk+JylbMF1cbiAgIyAgIHBsdWdpbi51cGRhdGVGaWVsZChmaWVsZCwge3RhZ3M6IFsnYXBwbGVzJywgJ29yYW5nZXMnLCAnY2FrZSddfSlcbiAgIyAgIGZpZWxkLnZhbHVlICMgPT4gUmV0dXJucyAnYXBwbGVzIG9yYW5nZXMgY2FrZSdcbiAgI1xuICAjIFJldHVybnMgbm90aGluZy5cbiAgdXBkYXRlRmllbGQ6IChmaWVsZCwgYW5ub3RhdGlvbikgPT5cbiAgICB2YWx1ZSA9ICcnXG4gICAgdmFsdWUgPSB0aGlzLnN0cmluZ2lmeVRhZ3MoYW5ub3RhdGlvbi50YWdzKSBpZiBhbm5vdGF0aW9uLnRhZ3NcblxuICAgIEBpbnB1dC52YWwodmFsdWUpXG5cbiAgIyBBbm5vdGF0b3IuRWRpdG9yIGNhbGxiYWNrIGZ1bmN0aW9uLiBVcGRhdGVzIHRoZSBhbm5vdGF0aW9uIGZpZWxkIHdpdGggdGhlXG4gICMgZGF0YSByZXRyaWV2ZWQgZnJvbSB0aGUgQGlucHV0IHByb3BlcnR5LlxuICAjXG4gICMgZmllbGQgICAgICAtIFRoZSB0YWdzIGZpZWxkIEVsZW1lbnQgY29udGFpbmluZyB0aGUgaW5wdXQgRWxlbWVudC5cbiAgIyBhbm5vdGF0aW9uIC0gQW4gYW5ub3RhdGlvbiBvYmplY3QgdG8gYmUgdXBkYXRlZC5cbiAgI1xuICAjIEV4YW1wbGVzXG4gICNcbiAgIyAgIGFubm90YXRpb24gPSB7fVxuICAjICAgZmllbGQgPSAkKCc8bGk+PGlucHV0IHZhbHVlPVwiY2FrZSBjaG9jb2xhdGUgY2FiYmFnZVwiIC8+PC9saT4nKVswXVxuICAjXG4gICMgICBwbHVnaW4uc2V0QW5ub3RhdGlvblRhZ3MoZmllbGQsIGFubm90YXRpb24pXG4gICMgICBhbm5vdGF0aW9uLnRhZ3MgIyA9PiBSZXR1cm5zIFsnY2FrZScsICdjaG9jb2xhdGUnLCAnY2FiYmFnZSddXG4gICNcbiAgIyBSZXR1cm5zIG5vdGhpbmcuXG4gIHNldEFubm90YXRpb25UYWdzOiAoZmllbGQsIGFubm90YXRpb24pID0+XG4gICAgYW5ub3RhdGlvbi50YWdzID0gdGhpcy5wYXJzZVRhZ3MoQGlucHV0LnZhbCgpKVxuXG4gICMgQW5ub3RhdG9yLlZpZXdlciBjYWxsYmFjayBmdW5jdGlvbi4gVXBkYXRlcyB0aGUgYW5ub3RhdGlvbiBkaXNwbGF5IHdpdGggdGFnc1xuICAjIHJlbW92ZXMgdGhlIGZpZWxkIGZyb20gdGhlIFZpZXdlciBpZiB0aGVyZSBhcmUgbm8gdGFncyB0byBkaXNwbGF5LlxuICAjXG4gICMgZmllbGQgICAgICAtIFRoZSBFbGVtZW50IHRvIHBvcHVsYXRlIHdpdGggdGFncy5cbiAgIyBhbm5vdGF0aW9uIC0gQW4gYW5ub3RhdGlvbiBvYmplY3QgdG8gYmUgZGlzcGxheS5cbiAgI1xuICAjIEV4YW1wbGVzXG4gICNcbiAgIyAgIGZpZWxkID0gJCgnPGRpdiAvPicpWzBdXG4gICMgICBwbHVnaW4udXBkYXRlRmllbGQoZmllbGQsIHt0YWdzOiBbJ2FwcGxlcyddfSlcbiAgIyAgIGZpZWxkLmlubmVySFRNTCAjID0+IFJldHVybnMgJzxzcGFuIGNsYXNzPVwiYW5ub3RhdG9yLXRhZ1wiPmFwcGxlczwvc3Bhbj4nXG4gICNcbiAgIyBSZXR1cm5zIG5vdGhpbmcuXG4gIHVwZGF0ZVZpZXdlcjogKGZpZWxkLCBhbm5vdGF0aW9uKSAtPlxuICAgIGZpZWxkID0gJChmaWVsZClcblxuICAgIGlmIGFubm90YXRpb24udGFncyBhbmQgJC5pc0FycmF5KGFubm90YXRpb24udGFncykgYW5kIGFubm90YXRpb24udGFncy5sZW5ndGhcbiAgICAgIGZpZWxkLmFkZENsYXNzKCdhbm5vdGF0b3ItdGFncycpLmh0bWwoLT5cbiAgICAgICAgc3RyaW5nID0gJC5tYXAoYW5ub3RhdGlvbi50YWdzLCh0YWcpIC0+XG4gICAgICAgICAgJzxzcGFuIGNsYXNzPVwiYW5ub3RhdG9yLXRhZ1wiPicgK1xuICAgICAgICAgIEFubm90YXRvci5VdGlsLmVzY2FwZSh0YWcpICtcbiAgICAgICAgICAnPC9zcGFuPidcbiAgICAgICAgKS5qb2luKCcgJylcbiAgICAgIClcbiAgICBlbHNlXG4gICAgICBmaWVsZC5yZW1vdmUoKVxuXG4jIENoZWNrcyBhbiBpbnB1dCBzdHJpbmcgb2Yga2V5d29yZHMgYWdhaW5zdCBhbiBhcnJheSBvZiB0YWdzLiBJZiB0aGUga2V5d29yZHNcbiMgbWF0Y2ggX2FsbF8gdGFncyB0aGUgZnVuY3Rpb24gcmV0dXJucyB0cnVlLiBUaGlzIHNob3VsZCBiZSB1c2VkIGFzIGEgY2FsbGJhY2tcbiMgaW4gdGhlIEZpbHRlciBwbHVnaW4uXG4jXG4jIGlucHV0IC0gQSBTdHJpbmcgb2Yga2V5d29yZHMgZnJvbSBhIGlucHV0IGZpZWxkLlxuI1xuIyBFeGFtcGxlc1xuI1xuIyAgIFRhZ3MuZmlsdGVyQ2FsbGJhY2soJ2NhdCBkb2cgbW91c2UnLCBbJ2NhdCcsICdkb2cnLCAnbW91c2UnXSkgLy89PiB0cnVlXG4jICAgVGFncy5maWx0ZXJDYWxsYmFjaygnY2F0IGRvZycsIFsnY2F0JywgJ2RvZycsICdtb3VzZSddKSAvLz0+IHRydWVcbiMgICBUYWdzLmZpbHRlckNhbGxiYWNrKCdjYXQgZG9nJywgWydjYXQnXSkgLy89PiBmYWxzZVxuI1xuIyBSZXR1cm5zIHRydWUgaWYgdGhlIGlucHV0IGtleXdvcmRzIG1hdGNoIGFsbCB0YWdzLlxuVGFncy5maWx0ZXJDYWxsYmFjayA9IChpbnB1dCwgdGFncyA9IFtdKSAtPlxuICBtYXRjaGVzICA9IDBcbiAga2V5d29yZHMgPSBbXVxuICBpZiBpbnB1dFxuICAgIGtleXdvcmRzID0gaW5wdXQuc3BsaXQoL1xccysvZylcbiAgICBmb3Iga2V5d29yZCBpbiBrZXl3b3JkcyB3aGVuIHRhZ3MubGVuZ3RoXG4gICAgICBtYXRjaGVzICs9IDEgZm9yIHRhZyBpbiB0YWdzIHdoZW4gdGFnLmluZGV4T2Yoa2V5d29yZCkgIT0gLTFcblxuICBtYXRjaGVzID09IGtleXdvcmRzLmxlbmd0aFxuXG5Bbm5vdGF0b3IuUGx1Z2luLnJlZ2lzdGVyKCdUYWdzJywgVGFncylcblxubW9kdWxlLmV4cG9ydHMgPSBUYWdzXG4iXX0=