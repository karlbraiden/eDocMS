/*
** Annotator v2.0.0-dev-41928d6
** https://github.com/okfn/annotator/
**
** Copyright 2014, the Annotator project contributors.
** Dual licensed under the MIT and GPLv3 licenses.
** https://github.com/okfn/annotator/blob/master/LICENSE
**
** Built at: 2014-04-11 02:53:37Z
*/
!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self);var n=e;n=n.Annotator||(n.Annotator={}),n=n.Plugin||(n.Plugin={}),n.Filter=t()}}(function(){return function t(e,n,i){function o(s,l){if(!n[s]){if(!e[s]){var a="function"==typeof require&&require;if(!l&&a)return a(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+s+"'")}var h=n[s]={exports:{}};e[s][0].call(h.exports,function(t){var n=e[s][1][t];return o(n?n:t)},h,h.exports,t,e,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({"4hR4NO":[function(t,e){(function(t){var n,i,o;if("undefined"!=typeof i&&null!==i&&(i=i),"undefined"!=typeof t&&null!==t&&null==i&&(i=t),"undefined"!=typeof window&&null!==window&&null==i&&(i=window),n=null!=i?i.Annotator:void 0,null==n&&(n=(null!=i?null!=(o=i.define)?o.amd:void 0:void 0)?null!=i?i.require("annotator"):void 0:void 0),"function"!=typeof n)throw new Error("Could not find Annotator! In a webpage context, please ensure that the Annotator script tag is loaded before any plugins.");e.exports=n}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],annotator:[function(t,e){e.exports=t("4hR4NO")},{}],3:[function(t,e){var n,i,o,r,s=function(t,e){return function(){return t.apply(e,arguments)}},l={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var i in e)l.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=t("annotator"),n=i.Util.$,r=i._t,o=function(t){function e(t,i){this._onPreviousClick=s(this._onPreviousClick,this),this._onNextClick=s(this._onNextClick,this),this._onFilterKeyup=s(this._onFilterKeyup,this),this._onFilterBlur=s(this._onFilterBlur,this),this._onFilterFocus=s(this._onFilterFocus,this),this.updateHighlights=s(this.updateHighlights,this);var o;t=n(this.html.element).appendTo((null!=i?i.appendTo:void 0)||this.options.appendTo),e.__super__.constructor.call(this,t,i),(o=this.options).filters||(o.filters=[]),this.filter=n(this.html.filter),this.filters=[],this.current=0}return a(e,t),e.prototype.events={".annotator-filter-property input focus":"_onFilterFocus",".annotator-filter-property input blur":"_onFilterBlur",".annotator-filter-property input keyup":"_onFilterKeyup",".annotator-filter-previous click":"_onPreviousClick",".annotator-filter-next click":"_onNextClick",".annotator-filter-clear click":"_onClearClick"},e.prototype.classes={active:"annotator-filter-active",hl:{hide:"annotator-hl-filtered",active:"annotator-hl-active"}},e.prototype.html={element:'<div class="annotator-filter">\n  <strong>'+r("Navigate:")+'</strong>\n  <span class="annotator-filter-navigation">\n    <button type="button"\n            class="annotator-filter-previous">'+r("Previous")+'</button>\n    <button type="button"\n            class="annotator-filter-next">'+r("Next")+"</button>\n  </span>\n  <strong>"+r("Filter by:")+"</strong>\n</div>",filter:'<span class="annotator-filter-property">\n  <label></label>\n  <input/>\n  <button type="button"\n          class="annotator-filter-clear">'+r("Clear")+"</button>\n</span>"},e.prototype.options={appendTo:"body",filters:[],addAnnotationFilter:!0,isFiltered:function(t,e){var n,i,o,r;if(!t||!e)return!1;for(r=t.split(/\s+/),i=0,o=r.length;o>i;i++)if(n=r[i],-1===e.indexOf(n))return!1;return!0}},e.prototype.pluginInit=function(){var t,e,n,o;for(o=this.options.filters,e=0,n=o.length;n>e;e++)t=o[e],this.addFilter(t);return this.updateHighlights(),this._setupListeners()._insertSpacer(),this.options.addAnnotationFilter===!0?this.addFilter({label:i._t("Annotation"),property:"text"}):void 0},e.prototype.destroy=function(){var t,i;return e.__super__.destroy.apply(this,arguments),i=n("html"),t=parseInt(i.css("padding-top"),10)||0,i.css("padding-top",t-this.element.outerHeight()),this.element.remove()},e.prototype._insertSpacer=function(){var t,e;return e=n("html"),t=parseInt(e.css("padding-top"),10)||0,e.css("padding-top",t+this.element.outerHeight()),this},e.prototype._setupListeners=function(){var t,e,n,i;for(e=["annotationsLoaded","annotationCreated","annotationUpdated","annotationDeleted"],n=0,i=e.length;i>n;n++)t=e[n],this.annotator.subscribe(t,this.updateHighlights);return this},e.prototype.addFilter=function(t){var e,o;return o=n.extend({label:"",property:"",isFiltered:this.options.isFiltered},t),function(){var t,n,i,r;for(i=this.filters,r=[],t=0,n=i.length;n>t;t++)e=i[t],e.property===o.property&&r.push(e);return r}.call(this).length||(o.id="annotator-filter-"+o.property,o.annotations=[],o.element=this.filter.clone().appendTo(this.element),o.element.find("label").html(o.label).attr("for",o.id),o.element.find("input").attr({id:o.id,placeholder:i._t("Filter by ")+o.label+"â€¦"}),o.element.find("button").hide(),o.element.data("filter",o),this.filters.push(o)),this},e.prototype.updateFilter=function(t){var e,i,o,r,s,l,a;if(t.annotations=[],this.updateHighlights(),this.resetHighlights(),o=n.trim(t.element.find("input").val())){for(i=this.highlights.map(function(){return n(this).data("annotation")}),a=n.makeArray(i),s=0,l=a.length;l>s;s++)e=a[s],r=e[t.property],t.isFiltered(o,r)&&t.annotations.push(e);return this.filterHighlights()}},e.prototype.updateHighlights=function(){return this.highlights=this.annotator.element.find(".annotator-hl:visible"),this.filtered=this.highlights.not(this.classes.hl.hide)},e.prototype.filterHighlights=function(){var t,e,i,o,r,s,l,a,h,u;for(t=n.grep(this.filters,function(t){return!!t.annotations.length}),o=(null!=(u=t[0])?u.annotations:void 0)||[],t.length>1&&(i=[],n.each(t,function(){return n.merge(i,this.annotations)}),l=[],o=[],n.each(i,function(){return-1===n.inArray(this,l)?l.push(this):o.push(this)})),r=this.highlights,s=a=0,h=o.length;h>a;s=++a)e=o[s],r=r.not(e.highlights);return r.addClass(this.classes.hl.hide),this.filtered=this.highlights.not(this.classes.hl.hide),this},e.prototype.resetHighlights=function(){return this.highlights.removeClass(this.classes.hl.hide),this.filtered=this.highlights,this},e.prototype._onFilterFocus=function(t){var e;return e=n(t.target),e.parent().addClass(this.classes.active),e.next("button").show()},e.prototype._onFilterBlur=function(t){var e;return t.target.value?void 0:(e=n(t.target),e.parent().removeClass(this.classes.active),e.next("button").hide())},e.prototype._onFilterKeyup=function(t){var e;return e=n(t.target).parent().data("filter"),e?this.updateFilter(e):void 0},e.prototype._findNextHighlight=function(t){var e,n,i,o,r,s,l,a;return this.highlights.length?(s=t?0:-1,a=t?-1:0,l=t?"lt":"gt",e=this.highlights.not("."+this.classes.hl.hide),i=e.filter("."+this.classes.hl.active),i.length||(i=e.eq(s)),n=i.data("annotation"),o=e.index(i[0]),r=e.filter(":"+l+"("+o+")").not(n.highlights).eq(a),r.length||(r=e.eq(a)),this._scrollToHighlight(r.data("annotation").highlights)):this},e.prototype._onNextClick=function(){return this._findNextHighlight()},e.prototype._onPreviousClick=function(){return this._findNextHighlight(!0)},e.prototype._scrollToHighlight=function(t){return t=n(t),this.highlights.removeClass(this.classes.hl.active),t.addClass(this.classes.hl.active),n("html, body").animate({scrollTop:t.offset().top-(this.element.height()+20)},150)},e.prototype._onClearClick=function(t){return n(t.target).prev("input").val("").keyup().blur()},e}(i.Plugin),i.Plugin.register("Filter",o),e.exports=o},{}]},{},[3])(3)});
//# sourceMappingURL=annotator.filter.min.js.map