/*
** Annotator v2.0.0-dev-41928d6
** https://github.com/okfn/annotator/
**
** Copyright 2014, the Annotator project contributors.
** Dual licensed under the MIT and GPLv3 licenses.
** https://github.com/okfn/annotator/blob/master/LICENSE
**
** Built at: 2014-04-11 02:53:36Z
*/
!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self);var i=e;i=i.Annotator||(i.Annotator={}),i=i.Plugin||(i.Plugin={}),i.Document=t()}}(function(){return function t(e,i,n){function o(a,s){if(!i[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+a+"'")}var h=i[a]={exports:{}};e[a][0].call(h.exports,function(t){var i=e[a][1][t];return o(i?i:t)},h,h.exports,t,e,i,n)}return i[a].exports}for(var r="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({"4hR4NO":[function(t,e){(function(t){var i,n,o;if("undefined"!=typeof n&&null!==n&&(n=n),"undefined"!=typeof t&&null!==t&&null==n&&(n=t),"undefined"!=typeof window&&null!==window&&null==n&&(n=window),i=null!=n?n.Annotator:void 0,null==i&&(i=(null!=n?null!=(o=n.define)?o.amd:void 0:void 0)?null!=n?n.require("annotator"):void 0:void 0),"function"!=typeof i)throw new Error("Could not find Annotator! In a webpage context, please ensure that the Annotator script tag is loaded before any plugins.");e.exports=i}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],annotator:[function(t,e){e.exports=t("4hR4NO")},{}],3:[function(t,e){var i,n,o,r=function(t,e){return function(){return t.apply(e,arguments)}},a={}.hasOwnProperty,s=function(t,e){function i(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};n=t("annotator"),i=n.Util.$,o=function(t){function e(){return this._getFavicon=r(this._getFavicon,this),this._getLinks=r(this._getLinks,this),this._getTitle=r(this._getTitle,this),this._getEprints=r(this._getEprints,this),this._getPrism=r(this._getPrism,this),this._getDublinCore=r(this._getDublinCore,this),this._getTwitter=r(this._getTwitter,this),this._getFacebook=r(this._getFacebook,this),this._getHighwire=r(this._getHighwire,this),this.getDocumentMetadata=r(this.getDocumentMetadata,this),this.uris=r(this.uris,this),this.uri=r(this.uri,this),e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.pluginInit=function(){return this.getDocumentMetadata(),this.listenTo(this.annotator,"beforeAnnotationCreated",this.beforeAnnotationCreated)},e.prototype.uri=function(){var t,e,i,n,o;for(e=decodeURIComponent(document.location.href),o=this.metadata,i=0,n=o.length;n>i;i++)t=o[i],"canonical"===t.rel&&(e=t.href);return e},e.prototype.uris=function(){var t,e,i,n,o,r;for(i={},r=this.metadata.link,n=0,o=r.length;o>n;n++)e=r[n],e.href&&(i[e.href]=!0);return function(){var e;e=[];for(t in i)e.push(t);return e}()},e.prototype.beforeAnnotationCreated=function(t){return t.document=this.metadata},e.prototype.getDocumentMetadata=function(){return this.metadata={},this._getHighwire(),this._getDublinCore(),this._getFacebook(),this._getEprints(),this._getPrism(),this._getTwitter(),this._getFavicon(),this._getTitle(),this._getLinks(),this.metadata},e.prototype._getHighwire=function(){return this.metadata.highwire=this._getMetaTags("citation","name","_")},e.prototype._getFacebook=function(){return this.metadata.facebook=this._getMetaTags("og","property",":")},e.prototype._getTwitter=function(){return this.metadata.twitter=this._getMetaTags("twitter","name",":")},e.prototype._getDublinCore=function(){return this.metadata.dc=this._getMetaTags("dc","name",".")},e.prototype._getPrism=function(){return this.metadata.prism=this._getMetaTags("prism","name",".")},e.prototype._getEprints=function(){return this.metadata.eprints=this._getMetaTags("eprints","name",".")},e.prototype._getMetaTags=function(t,e,n){var o,r,a,s,u,h,f,l,p;for(h={},p=i("meta"),f=0,l=p.length;l>f;f++)a=p[f],u=i(a).attr(e),o=i(a).prop("content"),u&&(r=u.match(RegExp("^"+t+n+"(.+)$","i")),r&&(s=r[1],h[s]?h[s].push(o):h[s]=[o]));return h},e.prototype._getTitle=function(){return this.metadata.title=this.metadata.highwire.title?this.metadata.highwire.title[0]:this.metadata.eprints.title?this.metadata.eprints.title:this.metadata.prism.title?this.metadata.prism.title:this.metadata.facebook.title?this.metadata.facebook.title:this.metadata.twitter.title?this.metadata.twitter.title:this.metadata.dc.title?this.metadata.dc.title:i("head title").text()},e.prototype._getLinks=function(){var t,e,n,o,r,a,s,u,h,f,l,p,d,c,g,m,_,y,w,v,b;for(this.metadata.link=[{href:document.location.href}],y=i("link"),p=0,g=y.length;g>p;p++)if(a=y[p],o=i(a),e=this._absoluteUrl(o.prop("href")),u=o.prop("rel"),h=o.prop("type"),r=o.prop("hreflang"),"alternate"===u||"canonical"===u||"bookmark"===u){if("alternate"===u){if(h&&h.match(/^application\/(rss|atom)\+xml/))continue;if(r)continue}this.metadata.link.push({href:e,rel:u,type:h})}w=this.metadata.highwire;for(s in w){if(l=w[s],"pdf_url"===s)for(d=0,m=l.length;m>d;d++)f=l[d],this.metadata.link.push({href:this._absoluteUrl(f),type:"application/pdf"});if("doi"===s)for(c=0,_=l.length;_>c;c++)t=l[c],"doi:"!==t.slice(0,4)&&(t="doi:"+t),this.metadata.link.push({href:t})}v=this.metadata.dc,b=[];for(s in v)l=v[s],b.push("identifier"===s?function(){var t,e,i;for(i=[],t=0,e=l.length;e>t;t++)n=l[t],i.push("doi:"===n.slice(0,4)?this.metadata.link.push({href:n}):void 0);return i}.call(this):void 0);return b},e.prototype._getFavicon=function(){var t,e,n,o,r,a;for(o=i("link"),a=[],e=0,n=o.length;n>e;e++)t=o[e],a.push("shortcut icon"===(r=i(t).prop("rel"))||"icon"===r?this.metadata.favicon=this._absoluteUrl(t.href):void 0);return a},e.prototype._absoluteUrl=function(t){var e;return e=document.createElement("a"),e.href=t,e.href},e}(n.Plugin),n.Plugin.register("Document",o),e.exports=o},{}]},{},[3])(3)});
//# sourceMappingURL=annotator.document.min.js.map