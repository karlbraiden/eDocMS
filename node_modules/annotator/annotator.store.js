/*
** Annotator v2.0.0-dev-d00e70f
** https://github.com/okfn/annotator/
**
** Copyright 2014, the Annotator project contributors.
** Dual licensed under the MIT and GPLv3 licenses.
** https://github.com/okfn/annotator/blob/master/LICENSE
**
** Built at: 2014-04-11 18:30:25Z
*/
!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self);var o=n;o=o.Annotator||(o.Annotator={}),o=o.Plugin||(o.Plugin={}),o.Store=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"4hR4NO":[function(_dereq_,module,exports){
(function (global){
var Annotator, self, _ref;

if (typeof self !== "undefined" && self !== null) {
  self = self;
}

if (typeof global !== "undefined" && global !== null) {
  if (self == null) {
    self = global;
  }
}

if (typeof window !== "undefined" && window !== null) {
  if (self == null) {
    self = window;
  }
}

Annotator = self != null ? self.Annotator : void 0;

if (Annotator == null) {
  Annotator = (self != null ? (_ref = self.define) != null ? _ref.amd : void 0 : void 0) ? self != null ? self.require('annotator') : void 0 : void 0;
}

if (typeof Annotator !== 'function') {
  throw new Error("Could not find Annotator! In a webpage context, please ensure that the Annotator script tag is loaded before any plugins.");
}

module.exports = Annotator;


}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],"annotator":[function(_dereq_,module,exports){
module.exports=_dereq_('4hR4NO');
},{}],3:[function(_dereq_,module,exports){
var $, Annotator, Store, Util, _t;

Annotator = _dereq_('annotator');

Util = Annotator.Util;

$ = Util.$;

_t = Util.TranslationString;

Store = (function() {
  Store.prototype.options = {
    annotationData: null,
    emulateHTTP: false,
    emulateJSON: false,
    headers: {},
    prefix: '/store',
    urls: {
      create: '/annotations',
      read: '/annotations/:id',
      update: '/annotations/:id',
      destroy: '/annotations/:id',
      search: '/search'
    }
  };

  function Store(options) {
    this.options = $.extend(true, {}, this.options, options);
  }

  Store.prototype.create = function(annotation) {
    return this._apiRequest('create', annotation);
  };

  Store.prototype.update = function(annotation) {
    return this._apiRequest('update', annotation);
  };

  Store.prototype["delete"] = function(annotation) {
    return this._apiRequest('destroy', annotation);
  };

  Store.prototype.query = function(queryObj) {
    var dfd;
    dfd = $.Deferred();
    this._apiRequest('search', queryObj).done(function(obj) {
      var rows;
      rows = obj.rows;
      delete obj.rows;
      return dfd.resolve(rows, obj);
    }).fail(function() {
      return dfd.reject.apply(dfd, arguments);
    });
    return dfd.promise();
  };

  Store.prototype.setHeader = function(key, value) {
    return this.options.headers[key] = value;
  };

  Store.prototype._apiRequest = function(action, obj) {
    var id, options, request, url;
    id = obj && obj.id;
    url = this._urlFor(action, id);
    options = this._apiRequestOptions(action, obj);
    request = $.ajax(url, options);
    request._id = id;
    request._action = action;
    return request;
  };

  Store.prototype._apiRequestOptions = function(action, obj) {
    var data, method, opts;
    method = this._methodFor(action);
    opts = {
      type: method,
      dataType: "json",
      error: this._onError,
      headers: this.options.headers
    };
    if (this.options.emulateHTTP && (method === 'PUT' || method === 'DELETE')) {
      opts.headers = $.extend(opts.headers, {
        'X-HTTP-Method-Override': method
      });
      opts.type = 'POST';
    }
    if (action === "search") {
      opts = $.extend(opts, {
        data: obj
      });
      return opts;
    }
    if (this.options.annotationData != null) {
      Util.deprecationWarning("Use of the annotationData option to the Store plugin is deprecated and will be removed in a future version. Please use hooks to beforeAnnotationCreated and beforeAnnotationUpdated to replicate this behaviour.");
      $.extend(obj, this.options.annotationData);
    }
    data = obj && JSON.stringify(obj);
    if (this.options.emulateJSON) {
      opts.data = {
        json: data
      };
      if (this.options.emulateHTTP) {
        opts.data._method = method;
      }
      return opts;
    }
    opts = $.extend(opts, {
      data: data,
      contentType: "application/json; charset=utf-8"
    });
    return opts;
  };

  Store.prototype._urlFor = function(action, id) {
    var url;
    url = this.options.prefix != null ? this.options.prefix : '';
    url += this.options.urls[action];
    url = url.replace(/\/:id/, id != null ? '/' + id : '');
    url = url.replace(/:id/, id != null ? id : '');
    return url;
  };

  Store.prototype._methodFor = function(action) {
    var table;
    table = {
      create: 'POST',
      read: 'GET',
      update: 'PUT',
      destroy: 'DELETE',
      search: 'GET'
    };
    return table[action];
  };

  Store.prototype._onError = function(xhr) {
    var action, message;
    action = xhr._action;
    message = _t("Sorry we could not ") + action + _t(" this annotation");
    if (xhr._action === 'search') {
      message = _t("Sorry we could not search the store for annotations");
    } else if (xhr._action === 'read' && !xhr._id) {
      message = _t("Sorry we could not ") + action + _t(" the annotations from the store");
    }
    switch (xhr.status) {
      case 401:
        message = _t("Sorry you are not allowed to ") + action + _t(" this annotation");
        break;
      case 404:
        message = _t("Sorry we could not connect to the annotations store");
        break;
      case 500:
        message = _t("Sorry something went wrong with the annotation store");
    }
    Annotator.showNotification(message, Annotator.Notification.ERROR);
    return console.error(_t("API request failed:") + (" '" + xhr.status + "'"));
  };

  return Store;

})();

Annotator.Plugin.register('Store', Store);

module.exports = Store;


},{}]},{},[3])

(3)
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGtnL2Fubm90YXRvci5zdG9yZS5qcyIsInNvdXJjZXMiOlsiLi4vbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIm5hbWVzcGFjZS5jb2ZmZWUiLCJwbHVnaW4vc3RvcmUuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTtBQ0tBOzs7U0FBTyxJQUFQOzs7QUFDQTs7V0FBUTtHQUFSO0NBREE7O0FBRUE7O1dBQVE7R0FBUjtDQUZBOzs7OztFQU1BLHNCQUFhO0NBTmI7O0FBVUE7QUFDRSxRQUFVLFVBQU0sb0JBRGxCO0NBVkE7Ozs7Ozs7Ozs7QUNMQTs7WUFBWSxRQUFRLFdBQVIsQ0FBWjs7SUFDQSxHQUFPLFNBQVMsQ0FBQyxJQURqQjs7Q0FFQSxHQUFJLElBQUksQ0FBQyxDQUZUOztFQUdBLEdBQUssSUFBSSxDQUFDLGlCQUhWOzs7QUFrQkUsNEJBTUU7b0JBQWdCLElBQWhCO0lBT0EsYUFBYSxLQVBiO0lBV0EsYUFBYSxLQVhiO0lBZUEsU0FBUyxFQWZUO0lBbUJBLFFBQVEsUUFuQlI7SUE4QkEsTUFDRTtjQUFRLGNBQVI7TUFDQSxNQUFNLGtCQUROO01BRUEsUUFBUSxrQkFGUjtNQUdBLFNBQVMsa0JBSFQ7TUFJQSxRQUFRLFNBSlI7S0EvQkY7R0FORjs7QUEyRGEsaUJBQUMsT0FBRDtBQUNYLFFBQUMsUUFBRCxHQUFXLENBQUMsQ0FBQyxNQUFGLENBQVMsSUFBVCxFQUFlLEVBQWYsRUFBbUIsSUFBQyxRQUFwQixFQUE2QixPQUE3QixDQUFYLENBRFc7R0EzRGI7O2tCQTBFQSxTQUFRLFNBQUMsVUFBRDtXQUNOLElBQUksQ0FBQyxXQUFMLENBQWlCLFFBQWpCLEVBQTJCLFVBQTNCLEVBRE07R0ExRVI7O2tCQXlGQSxTQUFRLFNBQUMsVUFBRDtXQUNOLElBQUksQ0FBQyxXQUFMLENBQWlCLFFBQWpCLEVBQTJCLFVBQTNCLEVBRE07R0F6RlI7O2tCQXdHQSxZQUFRLFNBQUMsVUFBRDtXQUNOLElBQUksQ0FBQyxXQUFMLENBQWlCLFNBQWpCLEVBQTRCLFVBQTVCLEVBRE07R0F4R1I7O2tCQThHQSxRQUFPLFNBQUMsUUFBRDtBQUNMO1VBQU0sQ0FBQyxDQUFDLFFBQUYsRUFBTjtJQUNBLElBQUksQ0FBQyxXQUFMLENBQWlCLFFBQWpCLEVBQTJCLFFBQTNCLENBQ0EsQ0FBQyxJQURELENBQ00sU0FBQyxHQUFEO0FBQ0o7YUFBTyxHQUFHLENBQUMsSUFBWDtNQUNBLFVBQVUsQ0FBQyxJQURYO2FBRUEsR0FBRyxDQUFDLE9BQUosQ0FBWSxJQUFaLEVBQWtCLEdBQWxCLEVBSEk7S0FETixDQUtBLENBQUMsSUFMRCxDQUtNO2FBQ0osR0FBRyxDQUFDLE1BQU0sQ0FBQyxLQUFYLENBQWlCLEdBQWpCLEVBQXNCLFNBQXRCLEVBREk7S0FMTixDQURBO0FBUUEsV0FBTyxHQUFHLENBQUMsT0FBSixFQUFQLENBVEs7R0E5R1A7O2tCQW1JQSxZQUFXLFNBQUMsR0FBRCxFQUFNLEtBQU47V0FDVCxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQVEsS0FBckIsR0FBNEIsTUFEbkI7R0FuSVg7O2tCQXVKQSxjQUFhLFNBQUMsTUFBRCxFQUFTLEdBQVQ7QUFDWDtTQUFLLE9BQU8sR0FBRyxDQUFDLEVBQWhCO0lBQ0EsTUFBTSxJQUFJLENBQUMsT0FBTCxDQUFhLE1BQWIsRUFBcUIsRUFBckIsQ0FETjtJQUVBLFVBQVUsSUFBSSxDQUFDLGtCQUFMLENBQXdCLE1BQXhCLEVBQWdDLEdBQWhDLENBRlY7SUFJQSxVQUFVLENBQUMsQ0FBQyxJQUFGLENBQU8sR0FBUCxFQUFZLE9BQVosQ0FKVjtJQVFBLE9BQU8sQ0FBQyxHQUFSLEdBQWMsRUFSZDtJQVNBLE9BQU8sQ0FBQyxPQUFSLEdBQWtCLE1BVGxCO1dBVUEsUUFYVztHQXZKYjs7a0JBMktBLHFCQUFvQixTQUFDLE1BQUQsRUFBUyxHQUFUO0FBQ2xCO2FBQVMsSUFBSSxDQUFDLFVBQUwsQ0FBZ0IsTUFBaEIsQ0FBVDtJQUVBLE9BQ0U7WUFBTSxNQUFOO01BQ0EsVUFBVSxNQURWO01BRUEsT0FBTyxJQUFJLENBQUMsUUFGWjtNQUdBLFNBQVMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUh0QjtLQUhGO0FBVUEsUUFBRyxJQUFDLFFBQU8sQ0FBQyxXQUFULElBQXlCLFlBQVcsS0FBWCxlQUFrQixRQUFsQixDQUE1QjtBQUNFLFVBQUksQ0FBQyxPQUFMLEdBQWUsQ0FBQyxDQUFDLE1BQUYsQ0FBUyxJQUFJLENBQUMsT0FBZCxFQUF1QjtRQUFDLDBCQUEwQixNQUEzQjtPQUF2QixDQUFmO01BQ0EsSUFBSSxDQUFDLElBQUwsR0FBWSxNQURaLENBREY7S0FWQTtBQWVBLFFBQUcsV0FBVSxRQUFiO0FBQ0UsYUFBTyxDQUFDLENBQUMsTUFBRixDQUFTLElBQVQsRUFBZTtjQUFNLEdBQU47T0FBZixDQUFQO0FBQ0EsYUFBTyxJQUFQLENBRkY7S0FmQTtBQXNCQSxRQUFHLG1DQUFIO0FBQ0UsVUFBSSxDQUFDLGtCQUFMLENBQXdCLGtOQUF4QjtNQU1BLENBQUMsQ0FBQyxNQUFGLENBQVMsR0FBVCxFQUFjLElBQUMsUUFBTyxDQUFDLGNBQXZCLENBTkEsQ0FERjtLQXRCQTtJQStCQSxPQUFPLE9BQU8sSUFBSSxDQUFDLFNBQUwsQ0FBZSxHQUFmLENBL0JkO0FBb0NBLFFBQUcsSUFBQyxRQUFPLENBQUMsV0FBWjtBQUNFLFVBQUksQ0FBQyxJQUFMLEdBQVk7UUFBQyxNQUFNLElBQVA7T0FBWjtBQUNBLFVBQUcsSUFBQyxRQUFPLENBQUMsV0FBWjtBQUNFLFlBQUksQ0FBQyxJQUFJLENBQUMsT0FBVixHQUFvQixNQUFwQixDQURGO09BREE7QUFHQSxhQUFPLElBQVAsQ0FKRjtLQXBDQTtJQTBDQSxPQUFPLENBQUMsQ0FBQyxNQUFGLENBQVMsSUFBVCxFQUFlO01BQ3BCLE1BQU0sSUFEYztNQUVwQixhQUFhLGlDQUZPO0tBQWYsQ0ExQ1A7QUE4Q0EsV0FBTyxJQUFQLENBL0NrQjtHQTNLcEI7O2tCQTBPQSxVQUFTLFNBQUMsTUFBRCxFQUFTLEVBQVQ7QUFDUDtVQUFTLDJCQUFILEdBQXlCLElBQUMsUUFBTyxDQUFDLE1BQWxDLEdBQThDLEVBQXBEO0lBQ0EsT0FBTyxJQUFDLFFBQU8sQ0FBQyxJQUFLLFFBRHJCO0lBSUEsTUFBTSxHQUFHLENBQUMsT0FBSixDQUFZLE9BQVosRUFBd0IsVUFBSCxHQUFZLE1BQU0sRUFBbEIsR0FBMEIsRUFBL0MsQ0FKTjtJQU1BLE1BQU0sR0FBRyxDQUFDLE9BQUosQ0FBWSxLQUFaLEVBQXNCLFVBQUgsR0FBWSxFQUFaLEdBQW9CLEVBQXZDLENBTk47V0FRQSxJQVRPO0dBMU9UOztrQkFnUUEsYUFBWSxTQUFDLE1BQUQ7QUFDVjtZQUNFO2NBQVEsTUFBUjtNQUNBLE1BQU0sS0FETjtNQUVBLFFBQVEsS0FGUjtNQUdBLFNBQVMsUUFIVDtNQUlBLFFBQVEsS0FKUjtLQURGO1dBT0EsS0FBTSxTQVJJO0dBaFFaOztrQkFnUkEsV0FBVSxTQUFDLEdBQUQ7QUFDUjthQUFVLEdBQUcsQ0FBQyxPQUFkO0lBQ0EsVUFBVSxHQUFHLHFCQUFILElBQTRCLE1BQTVCLEdBQXFDLEdBQUcsa0JBQUgsQ0FEL0M7QUFHQSxRQUFHLEdBQUcsQ0FBQyxPQUFKLEtBQWUsUUFBbEI7QUFDRSxnQkFBVSxHQUFHLHFEQUFILENBQVYsQ0FERjtXQUVLLElBQUcsR0FBRyxDQUFDLE9BQUosS0FBZSxNQUFmLElBQXlCLElBQUksQ0FBQyxHQUFqQztBQUNILGdCQUFVLEdBQUcscUJBQUgsSUFDQSxNQURBLEdBRUEsR0FBRyxpQ0FBSCxDQUZWLENBREc7S0FMTDtBQVVBLFlBQU8sR0FBRyxDQUFDLE1BQVg7V0FDTyxHQURQO0FBRUksa0JBQVUsR0FBRywrQkFBSCxJQUNBLE1BREEsR0FFQSxHQUFHLGtCQUFILENBRlYsQ0FGSjtBQUNPO0FBRFAsV0FLTyxHQUxQO0FBTUksa0JBQVUsR0FBRyxxREFBSCxDQUFWLENBTko7QUFLTztBQUxQLFdBT08sR0FQUDtBQVFJLGtCQUFVLEdBQUcsc0RBQUgsQ0FBVixDQVJKO0tBVkE7SUFvQkEsU0FBUyxDQUFDLGdCQUFWLENBQTJCLE9BQTNCLEVBQW9DLFNBQVMsQ0FBQyxZQUFZLENBQUMsS0FBM0QsQ0FwQkE7V0FzQkEsT0FBTyxDQUFDLEtBQVIsQ0FBYyxHQUFHLHFCQUFILElBQTRCLENBQUMsT0FBRyxHQUFHLENBQUMsTUFBUCxHQUFlLEdBQWhCLENBQTFDLEVBdkJRO0dBaFJWOzs7O0lBbEJGOztTQTJUUyxDQUFDLE1BQU0sQ0FBQyxRQUFqQixDQUEwQixPQUExQixFQUFtQyxLQUFuQyxDQTNUQTs7TUE2VE0sQ0FBQyxPQUFQLEdBQWlCLEtBN1RqQiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKX12YXIgZj1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwoZi5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxmLGYuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiIyBJbiBvcmRlciB0byBidWlsZCBwb3J0YWJsZSBleHRlbnNpb24gYnVuZGxlcyB0aGF0IGNhbiBiZSB1c2VkIHdpdGggQU1EIGFuZFxuIyBzY3JpcHQgY29uY2F0ZW5hdGlvbiBwbHVnaW5zIGFyZSBidWlsdCB3aXRoIHRoaXMgbW9kdWxlIGFzICdhbm5vdGF0b3InLlxuXG4jIEFubm90YXRvciB3aWxsIGV4cG9ydCBpdHNlbGYgZ2xvYmFsbHkgd2hlbiB0aGUgYnVpbHQgVU1EIG1vZHVsZXMgYXJlIHVzZWQgaW5cbiMgYSBsZWdhY3kgZW52aXJvbm1lbnQgb2Ygc2ltcGxlIHNjcmlwdCBjb25jYXRlbmF0aW9uLlxuc2VsZiA9IHNlbGYgaWYgc2VsZj9cbnNlbGYgPz0gZ2xvYmFsIGlmIGdsb2JhbD9cbnNlbGYgPz0gd2luZG93IGlmIHdpbmRvdz9cbkFubm90YXRvciA9IHNlbGY/LkFubm90YXRvclxuXG4jIEluIGEgcHVyZSBBTUQgZW52aXJvbm1lbnQsIEFubm90YXRvciBtYXkgbm90IGJlIGV4cG9ydGVkIGdsb2JhbGx5LlxuQW5ub3RhdG9yID89IGlmIHNlbGY/LmRlZmluZT8uYW1kIHRoZW4gc2VsZj8ucmVxdWlyZSgnYW5ub3RhdG9yJylcblxuIyBJZiB3ZSBoYXZlbid0IHN1Y2Nlc3NmdWxseSBsb2FkZWQgQW5ub3RhdG9yIGJ5IHRoaXMgcG9pbnQsIHRoZXJlJ3Mgbm8gcG9pbnQgaW5cbiMgZ29pbmcgb24gdG8gbG9hZCB0aGUgcGx1Z2luLCBzbyB0aHJvdyBhIGZhdGFsIGVycm9yLlxuaWYgdHlwZW9mIEFubm90YXRvciBpc250ICdmdW5jdGlvbidcbiAgdGhyb3cgbmV3IEVycm9yKFwiQ291bGQgbm90IGZpbmQgQW5ub3RhdG9yISBJbiBhIHdlYnBhZ2UgY29udGV4dCwgcGxlYXNlIGVuc3VyZVxuICAgICAgICAgICAgICAgICAgIHRoYXQgdGhlIEFubm90YXRvciBzY3JpcHQgdGFnIGlzIGxvYWRlZCBiZWZvcmUgYW55IHBsdWdpbnMuXCIpXG5cbiMgTm90ZTogd2hlbiB3b3JraW5nIGluIGEgQ29tbW9uSlMgZW52aXJvbm1lbnQgYW5kIGJ1bmRsaW5nIHJlcXVpcmVtZW50cyBpbnRvXG4jIGFwcGxpY2F0aW9ucyB0aGVuIHJlcXVpcmUgY2FsbHMgc2hvdWxkIHJlZmVyIHRvIG1vZHVsZXMgZnJvbSB0aGUgbnBtIGxpYlxuIyBkaXJlY3Rvcnkgb2YgYW5ub3RhdG9yIHBhY2thZ2UgYW5kIGF2b2lkIHRoaXMgYWx0b2dldGhlci5cbm1vZHVsZS5leHBvcnRzID0gQW5ub3RhdG9yXG4iLCJBbm5vdGF0b3IgPSByZXF1aXJlKCdhbm5vdGF0b3InKVxuVXRpbCA9IEFubm90YXRvci5VdGlsXG4kID0gVXRpbC4kXG5fdCA9IFV0aWwuVHJhbnNsYXRpb25TdHJpbmdcblxuXG4jIFB1YmxpYzogVGhlIFN0b3JlIHBsdWdpbiBjYW4gYmUgdXNlZCB0byBwZXJzaXN0IGFubm90YXRpb25zIHRvIGEgZGF0YWJhc2VcbiMgcnVubmluZyBvbiB5b3VyIHNlcnZlci4gSXQgaGFzIGEgc2ltcGxlIGN1c3RvbWlzYWJsZSBpbnRlcmZhY2UgdGhhdCBjYW4gYmVcbiMgaW1wbGVtZW50ZWQgd2l0aCBhbnkgd2ViIGZyYW1ld29yay4gSXQgd29ya3MgYnkgbGlzdGVuaW5nIHRvIGV2ZW50cyBwdWJsaXNoZWRcbiMgYnkgdGhlIEFubm90YXRvciBhbmQgbWFraW5nIGFwcHJvcHJpYXRlIHJlcXVlc3RzIHRvIHRoZSBzZXJ2ZXIgZGVwZW5kaW5nIG9uXG4jIHRoZSBldmVudC5cbiNcbiMgVGhlIHN0b3JlIGhhbmRsZXMgZml2ZSBkaXN0aW5jdCBhY3Rpb25zIFwicmVhZFwiLCBcInNlYXJjaFwiLCBcImNyZWF0ZVwiLCBcInVwZGF0ZVwiXG4jIGFuZCBcImRlc3Ryb3lcIi4gVGhlIHJlcXVlc3RzIG1hZGUgY2FuIGJlIGN1c3RvbWlzZWQgd2l0aCBvcHRpb25zIHdoZW4gdGhlXG4jIHBsdWdpbiBpcyBhZGRlZCB0byB0aGUgQW5ub3RhdG9yLlxuY2xhc3MgU3RvcmVcblxuICAjIFVzZXIgY3VzdG9taXNhYmxlIG9wdGlvbnMgYXZhaWxhYmxlLlxuICBvcHRpb25zOlxuXG4gICAgIyBDdXN0b20gbWV0YSBkYXRhIHRoYXQgd2lsbCBiZSBhdHRhY2hlZCB0byBldmVyeSBhbm5vdGF0aW9uIHRoYXQgaXMgc2VudFxuICAgICMgdG8gdGhlIHNlcnZlci4gVGhpcyBfd2lsbF8gb3ZlcnJpZGUgcHJldmlvdXMgdmFsdWVzLlxuICAgICNcbiAgICAjIEBzbGF0ZWRGb3JEZXByZWNhdGlvbiAyLjEuMFxuICAgIGFubm90YXRpb25EYXRhOiBudWxsXG5cbiAgICAjIFNob3VsZCB0aGUgcGx1Z2luIGVtdWxhdGUgSFRUUCBtZXRob2RzIGxpa2UgUFVUIGFuZCBERUxFVEUgZm9yXG4gICAgIyBpbnRlcmFjdGlvbiB3aXRoIGxlZ2FjeSB3ZWIgc2VydmVycz8gU2V0dGluZyB0aGlzIHRvIGB0cnVlYCB3aWxsIGZha2VcbiAgICAjIEhUVFAgYFBVVGAgYW5kIGBERUxFVEVgIHJlcXVlc3RzIHdpdGggYW4gSFRUUCBgUE9TVGAsIGFuZCB3aWxsIHNldCB0aGVcbiAgICAjIHJlcXVlc3QgaGVhZGVyIGBYLUhUVFAtTWV0aG9kLU92ZXJyaWRlYCB3aXRoIHRoZSBuYW1lIG9mIHRoZSBkZXNpcmVkXG4gICAgIyBtZXRob2QuXG4gICAgZW11bGF0ZUhUVFA6IGZhbHNlXG5cbiAgICAjIFNob3VsZCB0aGUgcGx1Z2luIGVtdWxhdGUgSlNPTiBQT1NUL1BVVCBwYXlsb2FkcyBieSBzZW5kaW5nIGl0cyByZXF1ZXN0c1xuICAgICMgYXMgYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIHdpdGggYSBzaW5nbGUga2V5LCBcImpzb25cIlxuICAgIGVtdWxhdGVKU09OOiBmYWxzZVxuXG4gICAgIyBBIHNldCBvZiBjdXN0b20gaGVhZGVycyB0aGF0IHdpbGwgYmUgc2VudCB3aXRoIGV2ZXJ5IHJlcXVlc3QuIFNlZSBhbHNvIHRoZVxuICAgICMgc2V0SGVhZGVyIG1ldGhvZC5cbiAgICBoZWFkZXJzOiB7fVxuXG4gICAgIyBUaGlzIGlzIHRoZSBBUEkgZW5kcG9pbnQuIElmIHRoZSBzZXJ2ZXIgc3VwcG9ydHMgQ3Jvc3MgT3JpZ2luIFJlc291cmNlXG4gICAgIyBTaGFyaW5nIChDT1JTKSBhIGZ1bGwgVVJMIGNhbiBiZSB1c2VkIGhlcmUuXG4gICAgcHJlZml4OiAnL3N0b3JlJ1xuXG4gICAgIyBUaGUgc2VydmVyIFVSTHMgZm9yIGVhY2ggYXZhaWxhYmxlIGFjdGlvbi4gVGhlc2UgVVJMcyBjYW4gYmUgYW55dGhpbmcgYnV0XG4gICAgIyBtdXN0IHJlc3BvbmQgdG8gdGhlIGFwcHJvcHJhaXRlIEhUVFAgbWV0aG9kLiBUaGUgdG9rZW4gXCI6aWRcIiBjYW4gYmUgdXNlZFxuICAgICMgYW55d2hlcmUgaW4gdGhlIFVSTCBhbmQgd2lsbCBiZSByZXBsYWNlZCB3aXRoIHRoZSBhbm5vdGF0aW9uIGlkLlxuICAgICNcbiAgICAjIHJlYWQ6ICAgIEdFVFxuICAgICMgY3JlYXRlOiAgUE9TVFxuICAgICMgdXBkYXRlOiAgUFVUXG4gICAgIyBkZXN0cm95OiBERUxFVEVcbiAgICAjIHNlYXJjaDogIEdFVFxuICAgIHVybHM6XG4gICAgICBjcmVhdGU6ICcvYW5ub3RhdGlvbnMnXG4gICAgICByZWFkOiAnL2Fubm90YXRpb25zLzppZCdcbiAgICAgIHVwZGF0ZTogJy9hbm5vdGF0aW9ucy86aWQnXG4gICAgICBkZXN0cm95OiAnL2Fubm90YXRpb25zLzppZCdcbiAgICAgIHNlYXJjaDogJy9zZWFyY2gnXG5cbiAgIyBQdWJsaWM6IFRoZSBjb250c3J1Y3RvciBpbml0YWlsYXNlcyB0aGUgU3RvcmUgaW5zdGFuY2UuIEl0IHJlcXVpcmVzIHRoZVxuICAjIEFubm90YXRvciNlbGVtZW50IGFuZCBhbiBPYmplY3Qgb2Ygb3B0aW9ucy5cbiAgI1xuICAjIGVsZW1lbnQgLSBUaGlzIG11c3QgYmUgdGhlIEFubm90YXRvciNlbGVtZW50IGluIG9yZGVyIHRvIGxpc3RlbiBmb3IgZXZlbnRzLlxuICAjIG9wdGlvbnMgLSBBbiBPYmplY3Qgb2Yga2V5L3ZhbHVlIHVzZXIgb3B0aW9ucy5cbiAgI1xuICAjIEV4YW1wbGVzXG4gICNcbiAgIyAgIHN0b3JlID0gbmV3IEFubm90YXRvci5QbHVnaW4uU3RvcmUoQW5ub3RhdG9yLmVsZW1lbnQsIHtcbiAgIyAgICAgcHJlZml4OiAnaHR0cDovL2Fubm90YXRlaXQub3JnJyxcbiAgIyAgICAgYW5ub3RhdGlvbkRhdGE6IHtcbiAgIyAgICAgICB1cmk6IHdpbmRvdy5sb2NhdGlvbi5ocmVmXG4gICMgICAgIH1cbiAgIyAgIH0pXG4gICNcbiAgIyBSZXR1cm5zIGEgbmV3IGluc3RhbmNlIG9mIFN0b3JlLlxuICBjb25zdHJ1Y3RvcjogKG9wdGlvbnMpIC0+XG4gICAgQG9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgQG9wdGlvbnMsIG9wdGlvbnMpXG5cbiAgIyBQdWJsaWM6IENhbGxiYWNrIG1ldGhvZCBmb3IgYW5ub3RhdGlvbkNyZWF0ZWQgZXZlbnQuIFJlY2VpdmVzIGFuIGFubm90YXRpb25cbiAgIyBhbmQgc2VuZHMgYSBQT1NUIHJlcXVlc3QgdG8gdGhlIHNldmVyIHVzaW5nIHRoZSBVUkkgZm9yIHRoZSBcImNyZWF0ZVwiIGFjdGlvbi5cbiAgI1xuICAjIGFubm90YXRpb24gLSBBbiBhbm5vdGF0aW9uIE9iamVjdCB0aGF0IHdhcyBjcmVhdGVkLlxuICAjXG4gICMgRXhhbXBsZXNcbiAgI1xuICAjICAgc3RvcmUuYW5ub3RhdGlvbkNyZWF0ZWQoe3RleHQ6IFwibXkgbmV3IGFubm90YXRpb24gY29tbWVudFwifSlcbiAgIyAgICMgPT4gUmVzdWx0cyBpbiBhbiBIVFRQIFBPU1QgcmVxdWVzdCB0byB0aGUgc2VydmVyIGNvbnRhaW5pbmcgdGhlXG4gICMgICAjICAgIGFubm90YXRpb24gYXMgc2VyaWFsaXNlZCBKU09OLlxuICAjXG4gICMgUmV0dXJucyBhIGpxWEhSIG9iamVjdC5cbiAgY3JlYXRlOiAoYW5ub3RhdGlvbikgLT5cbiAgICB0aGlzLl9hcGlSZXF1ZXN0KCdjcmVhdGUnLCBhbm5vdGF0aW9uKVxuXG4gICMgUHVibGljOiBDYWxsYmFjayBtZXRob2QgZm9yIGFubm90YXRpb25VcGRhdGVkIGV2ZW50LiBSZWNlaXZlcyBhbiBhbm5vdGF0aW9uXG4gICMgYW5kIHNlbmRzIGEgUFVUIHJlcXVlc3QgdG8gdGhlIHNldmVyIHVzaW5nIHRoZSBVUkkgZm9yIHRoZSBcInVwZGF0ZVwiIGFjdGlvbi5cbiAgI1xuICAjIGFubm90YXRpb24gLSBBbiBhbm5vdGF0aW9uIE9iamVjdCB0aGF0IHdhcyB1cGRhdGVkLlxuICAjXG4gICMgRXhhbXBsZXNcbiAgI1xuICAjICAgc3RvcmUuYW5ub3RhdGlvblVwZGF0ZWQoe2lkOiBcImJsYWhcIiwgdGV4dDogXCJ1cGRhdGVkIGFubm90YXRpb24gY29tbWVudFwifSlcbiAgIyAgICMgPT4gUmVzdWx0cyBpbiBhbiBIVFRQIFBVVCByZXF1ZXN0IHRvIHRoZSBzZXJ2ZXIgY29udGFpbmluZyB0aGVcbiAgIyAgICMgICAgYW5ub3RhdGlvbiBhcyBzZXJpYWxpc2VkIEpTT04uXG4gICNcbiAgIyBSZXR1cm5zIGEganFYSFIgb2JqZWN0LlxuICB1cGRhdGU6IChhbm5vdGF0aW9uKSAtPlxuICAgIHRoaXMuX2FwaVJlcXVlc3QoJ3VwZGF0ZScsIGFubm90YXRpb24pXG5cbiAgIyBQdWJsaWM6IENhbGxiYWNrIG1ldGhvZCBmb3IgYW5ub3RhdGlvbkRlbGV0ZWQgZXZlbnQuIFJlY2VpdmVzIGFuIGFubm90YXRpb25cbiAgIyBhbmQgc2VuZHMgYSBERUxFVEUgcmVxdWVzdCB0byB0aGUgc2VydmVyIHVzaW5nIHRoZSBVUkkgZm9yIHRoZSBkZXN0cm95XG4gICMgYWN0aW9uLlxuICAjXG4gICMgYW5ub3RhdGlvbiAtIEFuIGFubm90YXRpb24gT2JqZWN0IHRoYXQgd2FzIGRlbGV0ZWQuXG4gICNcbiAgIyBFeGFtcGxlc1xuICAjXG4gICMgICBzdG9yZS5hbm5vdGF0aW9uRGVsZXRlZCh7dGV4dDogXCJteSBuZXcgYW5ub3RhdGlvbiBjb21tZW50XCJ9KVxuICAjICAgIyA9PiBSZXN1bHRzIGluIGFuIEhUVFAgREVMRVRFIHJlcXVlc3QgdG8gdGhlIHNlcnZlci5cbiAgI1xuICAjIFJldHVybnMgYSBqcVhIUiBvYmplY3QuXG4gIGRlbGV0ZTogKGFubm90YXRpb24pIC0+XG4gICAgdGhpcy5fYXBpUmVxdWVzdCgnZGVzdHJveScsIGFubm90YXRpb24pXG5cbiAgIyBQdWJsaWM6IFNlYXJjaGVzIGZvciBhbm5vdGF0aW9ucyBtYXRjaGluZyB0aGUgc3BlY2lmaWVkIHF1ZXJ5LlxuICAjXG4gICMgUmV0dXJucyBhIFByb21pc2UgcmVzb2x2aW5nIHRvIHRoZSBxdWVyeSByZXN1bHRzIGFuZCBxdWVyeSBtZXRhZGF0YS5cbiAgcXVlcnk6IChxdWVyeU9iaikgLT5cbiAgICBkZmQgPSAkLkRlZmVycmVkKClcbiAgICB0aGlzLl9hcGlSZXF1ZXN0KCdzZWFyY2gnLCBxdWVyeU9iailcbiAgICAuZG9uZSAob2JqKSAtPlxuICAgICAgcm93cyA9IG9iai5yb3dzXG4gICAgICBkZWxldGUgb2JqLnJvd3NcbiAgICAgIGRmZC5yZXNvbHZlKHJvd3MsIG9iailcbiAgICAuZmFpbCAtPlxuICAgICAgZGZkLnJlamVjdC5hcHBseShkZmQsIGFyZ3VtZW50cylcbiAgICByZXR1cm4gZGZkLnByb21pc2UoKVxuXG4gICMgUHVibGljOiBTZXQgYSBjdXN0b20gSFRUUCBoZWFkZXIgdG8gYmUgc2VudCB3aXRoIGV2ZXJ5IHJlcXVlc3QuXG4gICNcbiAgIyBrZXkgICAtIFRoZSBoZWFkZXIgbmFtZS5cbiAgIyB2YWx1ZSAtIFRoZSBoZWFkZXIgdmFsdWUuXG4gICNcbiAgIyBFeGFtcGxlczpcbiAgI1xuICAjICAgc3RvcmUuc2V0SGVhZGVyKCdYLU15LUN1c3RvbS1IZWFkZXInLCAnTXlDdXN0b21WYWx1ZScpXG4gICNcbiAgIyBSZXR1cm5zIG5vdGhpbmcuXG4gIHNldEhlYWRlcjogKGtleSwgdmFsdWUpIC0+XG4gICAgdGhpcy5vcHRpb25zLmhlYWRlcnNba2V5XSA9IHZhbHVlXG5cbiAgIyBDYWxsYmFjayBtZXRob2QgZm9yIFN0b3JlI2xvYWRBbm5vdGF0aW9uc0Zyb21TZWFyY2goKS4gUHJvY2Vzc2VzIHRoZSBkYXRhXG4gICMgcmV0dXJuZWQgZnJvbSB0aGUgc2VydmVyIChhIEpTT04gYXJyYXkgb2YgYW5ub3RhdGlvbiBPYmplY3RzKSBhbmQgdXBkYXRlc1xuICAjIHRoZSByZWdpc3RyeSBhcyB3ZWxsIGFzIGxvYWRpbmcgdGhlbSBpbnRvIHRoZSBBbm5vdGF0b3IuXG4gICMgUmV0dXJucyB0aGUgalF1ZXJ5IFhNTEh0dHBSZXF1ZXN0IHdyYXBwZXIgZW5hYmxpbmcgYWRkaXRpb25hbCBjYWxsYmFja3MgdG9cbiAgIyBiZSBhcHBsaWVkIGFzIHdlbGwgYXMgY3VzdG9tIGVycm9yIGhhbmRsaW5nLlxuICAjXG4gICMgYWN0aW9uICAgIC0gVGhlIGFjdGlvbiBTdHJpbmcgZWcuIFwicmVhZFwiLCBcInNlYXJjaFwiLCBcImNyZWF0ZVwiLCBcInVwZGF0ZVwiXG4gICMgICAgICAgICAgICAgb3IgXCJkZXN0b3J5XCIuXG4gICMgb2JqICAgICAgIC0gVGhlIGRhdGEgdG8gYmUgc2VudCwgZWl0aGVyIGFubm90YXRpb24gb2JqZWN0IG9yIHF1ZXJ5IHN0cmluZy5cbiAgIyBvblN1Y2Nlc3MgLSBBIGNhbGxiYWNrIEZ1bmN0aW9uIHRvIGNhbGwgb24gc3VjY2Vzc2Z1bCByZXF1ZXN0LlxuICAjXG4gICMgRXhhbXBsZXM6XG4gICNcbiAgIyAgIHN0b3JlLl9hcGlSZXF1ZXN0KCdyZWFkJywge2lkOiA0fSwgKGRhdGEpIC0+IGNvbnNvbGUubG9nKGRhdGEpKVxuICAjICAgIyA9PiBPdXRwdXRzIHRoZSBhbm5vdGF0aW9uIHJldHVybmVkIGZyb20gdGhlIHNlcnZlci5cbiAgI1xuICAjIFJldHVybnMgWE1MSHR0cFJlcXVlc3Qgb2JqZWN0LlxuICBfYXBpUmVxdWVzdDogKGFjdGlvbiwgb2JqKSAtPlxuICAgIGlkID0gb2JqICYmIG9iai5pZFxuICAgIHVybCA9IHRoaXMuX3VybEZvcihhY3Rpb24sIGlkKVxuICAgIG9wdGlvbnMgPSB0aGlzLl9hcGlSZXF1ZXN0T3B0aW9ucyhhY3Rpb24sIG9iailcblxuICAgIHJlcXVlc3QgPSAkLmFqYXgodXJsLCBvcHRpb25zKVxuXG4gICAgIyBBcHBlbmQgdGhlIGlkIGFuZCBhY3Rpb24gdG8gdGhlIHJlcXVlc3Qgb2JqZWN0XG4gICAgIyBmb3IgdXNlIGluIHRoZSBlcnJvciBjYWxsYmFjay5cbiAgICByZXF1ZXN0Ll9pZCA9IGlkXG4gICAgcmVxdWVzdC5fYWN0aW9uID0gYWN0aW9uXG4gICAgcmVxdWVzdFxuXG4gICMgQnVpbGRzIGFuIG9wdGlvbnMgb2JqZWN0IHN1aXRhYmxlIGZvciB1c2UgaW4gYSBqUXVlcnkuYWpheCgpIGNhbGwuXG4gICNcbiAgIyBhY3Rpb24gICAgLSBUaGUgYWN0aW9uIFN0cmluZyBlZy4gXCJyZWFkXCIsIFwic2VhcmNoXCIsIFwiY3JlYXRlXCIsIFwidXBkYXRlXCJcbiAgIyAgICAgICAgICAgICBvciBcImRlc3Ryb3lcIi5cbiAgIyBvYmogICAgICAgLSBUaGUgZGF0YSB0byBiZSBzZW50LCBlaXRoZXIgYW5ub3RhdGlvbiBvYmplY3Qgb3IgcXVlcnkgc3RyaW5nLlxuICAjXG4gICMgUmV0dXJucyBPYmplY3QgbGl0ZXJhbCBvZiAkLmFqYXgoKSBvcHRpb25zLlxuICBfYXBpUmVxdWVzdE9wdGlvbnM6IChhY3Rpb24sIG9iaikgLT5cbiAgICBtZXRob2QgPSB0aGlzLl9tZXRob2RGb3IoYWN0aW9uKVxuXG4gICAgb3B0cyA9XG4gICAgICB0eXBlOiBtZXRob2QsXG4gICAgICBkYXRhVHlwZTogXCJqc29uXCIsXG4gICAgICBlcnJvcjogdGhpcy5fb25FcnJvcixcbiAgICAgIGhlYWRlcnM6IHRoaXMub3B0aW9ucy5oZWFkZXJzXG5cbiAgICAjIElmIGVtdWxhdGVIVFRQIGlzIGVuYWJsZWQsIHdlIHNlbmQgYSBQT1NUIGFuZCBwdXQgdGhlIHJlYWwgbWV0aG9kIGluIGFuXG4gICAgIyBIVFRQIHJlcXVlc3QgaGVhZGVyLlxuICAgIGlmIEBvcHRpb25zLmVtdWxhdGVIVFRQIGFuZCBtZXRob2QgaW4gWydQVVQnLCAnREVMRVRFJ11cbiAgICAgIG9wdHMuaGVhZGVycyA9ICQuZXh0ZW5kKG9wdHMuaGVhZGVycywgeydYLUhUVFAtTWV0aG9kLU92ZXJyaWRlJzogbWV0aG9kfSlcbiAgICAgIG9wdHMudHlwZSA9ICdQT1NUJ1xuXG4gICAgIyBEb24ndCBKU09OaWZ5IG9iaiBpZiBtYWtpbmcgc2VhcmNoIHJlcXVlc3QuXG4gICAgaWYgYWN0aW9uIGlzIFwic2VhcmNoXCJcbiAgICAgIG9wdHMgPSAkLmV4dGVuZChvcHRzLCBkYXRhOiBvYmopXG4gICAgICByZXR1cm4gb3B0c1xuXG4gICAgIyBBZGQgYW5ub3RhdGlvbkRhdGEgdG8gb2JqZWN0LCBpZiBzcGVjaWZpZWRcbiAgICAjXG4gICAgIyBAc2xhdGVkRm9yRGVwcmVjYXRpb24gMi4xLjBcbiAgICBpZiBAb3B0aW9ucy5hbm5vdGF0aW9uRGF0YT9cbiAgICAgIFV0aWwuZGVwcmVjYXRpb25XYXJuaW5nKFwiVXNlIG9mIHRoZSBhbm5vdGF0aW9uRGF0YSBvcHRpb24gdG8gdGhlIFN0b3JlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGx1Z2luIGlzIGRlcHJlY2F0ZWQgYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiBhXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnV0dXJlIHZlcnNpb24uIFBsZWFzZSB1c2UgaG9va3MgdG9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWZvcmVBbm5vdGF0aW9uQ3JlYXRlZCBhbmRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWZvcmVBbm5vdGF0aW9uVXBkYXRlZCB0byByZXBsaWNhdGUgdGhpc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlaGF2aW91ci5cIilcbiAgICAgICQuZXh0ZW5kKG9iaiwgQG9wdGlvbnMuYW5ub3RhdGlvbkRhdGEpXG5cbiAgICBkYXRhID0gb2JqICYmIEpTT04uc3RyaW5naWZ5KG9iailcblxuICAgICMgSWYgZW11bGF0ZUpTT04gaXMgZW5hYmxlZCwgd2Ugc2VuZCBhIGZvcm0gcmVxdWVzdCAodGhlIGNvcnJlY3RcbiAgICAjIGNvbnRlbnRUeXBlIHdpbGwgYmUgc2V0IGF1dG9tYXRpY2FsbHkgYnkgalF1ZXJ5KSwgYW5kIHB1dCB0aGVcbiAgICAjIEpTT04tZW5jb2RlZCBwYXlsb2FkIGluIHRoZSBcImpzb25cIiBrZXkuXG4gICAgaWYgQG9wdGlvbnMuZW11bGF0ZUpTT05cbiAgICAgIG9wdHMuZGF0YSA9IHtqc29uOiBkYXRhfVxuICAgICAgaWYgQG9wdGlvbnMuZW11bGF0ZUhUVFBcbiAgICAgICAgb3B0cy5kYXRhLl9tZXRob2QgPSBtZXRob2RcbiAgICAgIHJldHVybiBvcHRzXG5cbiAgICBvcHRzID0gJC5leHRlbmQob3B0cywge1xuICAgICAgZGF0YTogZGF0YVxuICAgICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOFwiXG4gICAgfSlcbiAgICByZXR1cm4gb3B0c1xuXG4gICMgQnVpbGRzIHRoZSBhcHByb3ByaWF0ZSBVUkwgZnJvbSB0aGUgb3B0aW9ucyBmb3IgdGhlIGFjdGlvbiBwcm92aWRlZC5cbiAgI1xuICAjIGFjdGlvbiAtIFRoZSBhY3Rpb24gU3RyaW5nLlxuICAjIGlkICAgICAtIFRoZSBhbm5vdGF0aW9uIGlkIGFzIGEgU3RyaW5nIG9yIE51bWJlci5cbiAgI1xuICAjIEV4YW1wbGVzXG4gICNcbiAgIyAgIHN0b3JlLl91cmxGb3IoJ3VwZGF0ZScsIDM0KVxuICAjICAgIyA9PiBSZXR1cm5zIFwiL3N0b3JlL2Fubm90YXRpb25zLzM0XCJcbiAgI1xuICAjICAgc3RvcmUuX3VybEZvcignc2VhcmNoJylcbiAgIyAgICMgPT4gUmV0dXJucyBcIi9zdG9yZS9zZWFyY2hcIlxuICAjXG4gICMgUmV0dXJucyBVUkwgU3RyaW5nLlxuICBfdXJsRm9yOiAoYWN0aW9uLCBpZCkgLT5cbiAgICB1cmwgPSBpZiBAb3B0aW9ucy5wcmVmaXg/IHRoZW4gQG9wdGlvbnMucHJlZml4IGVsc2UgJydcbiAgICB1cmwgKz0gQG9wdGlvbnMudXJsc1thY3Rpb25dXG4gICAgIyBJZiB0aGVyZSdzIGEgJy86aWQnIGluIHRoZSBVUkwsIGVpdGhlciBmaWxsIGluIHRoZSBJRCBvciByZW1vdmUgdGhlXG4gICAgIyBzbGFzaDpcbiAgICB1cmwgPSB1cmwucmVwbGFjZSgvXFwvOmlkLywgaWYgaWQ/IHRoZW4gJy8nICsgaWQgZWxzZSAnJylcbiAgICAjIElmIHRoZXJlJ3MgYSBiYXJlICc6aWQnIGluIHRoZSBVUkwsIHRoZW4gc3Vic3RpdHV0ZSBkaXJlY3RseTpcbiAgICB1cmwgPSB1cmwucmVwbGFjZSgvOmlkLywgaWYgaWQ/IHRoZW4gaWQgZWxzZSAnJylcblxuICAgIHVybFxuXG4gICMgTWFwcyBhbiBhY3Rpb24gdG8gYW4gSFRUUCBtZXRob2QuXG4gICNcbiAgIyBhY3Rpb24gLSBUaGUgYWN0aW9uIFN0cmluZy5cbiAgI1xuICAjIEV4YW1wbGVzXG4gICNcbiAgIyAgIHN0b3JlLl9tZXRob2RGb3IoJ3JlYWQnKSAgICAjID0+IFwiR0VUXCJcbiAgIyAgIHN0b3JlLl9tZXRob2RGb3IoJ3VwZGF0ZScpICAjID0+IFwiUFVUXCJcbiAgIyAgIHN0b3JlLl9tZXRob2RGb3IoJ2Rlc3Ryb3knKSAjID0+IFwiREVMRVRFXCJcbiAgI1xuICAjIFJldHVybnMgSFRUUCBtZXRob2QgU3RyaW5nLlxuICBfbWV0aG9kRm9yOiAoYWN0aW9uKSAtPlxuICAgIHRhYmxlID1cbiAgICAgIGNyZWF0ZTogJ1BPU1QnXG4gICAgICByZWFkOiAnR0VUJ1xuICAgICAgdXBkYXRlOiAnUFVUJ1xuICAgICAgZGVzdHJveTogJ0RFTEVURSdcbiAgICAgIHNlYXJjaDogJ0dFVCdcblxuICAgIHRhYmxlW2FjdGlvbl1cblxuICAjIGpRdWVyeS5hamF4KCkgY2FsbGJhY2suIERpc3BsYXlzIGFuIGVycm9yIG5vdGlmaWNhdGlvbiB0byB0aGUgdXNlciBpZlxuICAjIHRoZSByZXF1ZXN0IGZhaWxlZC5cbiAgI1xuICAjIHhociAtIFRoZSBqWE1MSHR0cFJlcXVlc3Qgb2JqZWN0LlxuICAjXG4gICMgUmV0dXJucyBub3RoaW5nLlxuICBfb25FcnJvcjogKHhocikgLT5cbiAgICBhY3Rpb24gID0geGhyLl9hY3Rpb25cbiAgICBtZXNzYWdlID0gX3QoXCJTb3JyeSB3ZSBjb3VsZCBub3QgXCIpICsgYWN0aW9uICsgX3QoXCIgdGhpcyBhbm5vdGF0aW9uXCIpXG5cbiAgICBpZiB4aHIuX2FjdGlvbiA9PSAnc2VhcmNoJ1xuICAgICAgbWVzc2FnZSA9IF90KFwiU29ycnkgd2UgY291bGQgbm90IHNlYXJjaCB0aGUgc3RvcmUgZm9yIGFubm90YXRpb25zXCIpXG4gICAgZWxzZSBpZiB4aHIuX2FjdGlvbiA9PSAncmVhZCcgJiYgIXhoci5faWRcbiAgICAgIG1lc3NhZ2UgPSBfdChcIlNvcnJ5IHdlIGNvdWxkIG5vdCBcIikgK1xuICAgICAgICAgICAgICAgIGFjdGlvbiArXG4gICAgICAgICAgICAgICAgX3QoXCIgdGhlIGFubm90YXRpb25zIGZyb20gdGhlIHN0b3JlXCIpXG5cbiAgICBzd2l0Y2ggeGhyLnN0YXR1c1xuICAgICAgd2hlbiA0MDFcbiAgICAgICAgbWVzc2FnZSA9IF90KFwiU29ycnkgeW91IGFyZSBub3QgYWxsb3dlZCB0byBcIikgK1xuICAgICAgICAgICAgICAgICAgYWN0aW9uICtcbiAgICAgICAgICAgICAgICAgIF90KFwiIHRoaXMgYW5ub3RhdGlvblwiKVxuICAgICAgd2hlbiA0MDRcbiAgICAgICAgbWVzc2FnZSA9IF90KFwiU29ycnkgd2UgY291bGQgbm90IGNvbm5lY3QgdG8gdGhlIGFubm90YXRpb25zIHN0b3JlXCIpXG4gICAgICB3aGVuIDUwMFxuICAgICAgICBtZXNzYWdlID0gX3QoXCJTb3JyeSBzb21ldGhpbmcgd2VudCB3cm9uZyB3aXRoIHRoZSBhbm5vdGF0aW9uIHN0b3JlXCIpXG5cbiAgICBBbm5vdGF0b3Iuc2hvd05vdGlmaWNhdGlvbiBtZXNzYWdlLCBBbm5vdGF0b3IuTm90aWZpY2F0aW9uLkVSUk9SXG5cbiAgICBjb25zb2xlLmVycm9yIF90KFwiQVBJIHJlcXVlc3QgZmFpbGVkOlwiKSArIFwiICcje3hoci5zdGF0dXN9J1wiXG5cbkFubm90YXRvci5QbHVnaW4ucmVnaXN0ZXIoJ1N0b3JlJywgU3RvcmUpXG5cbm1vZHVsZS5leHBvcnRzID0gU3RvcmVcbiJdfQ==