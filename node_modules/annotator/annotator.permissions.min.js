/*
** Annotator v2.0.0-dev-41928d6
** https://github.com/okfn/annotator/
**
** Copyright 2014, the Annotator project contributors.
** Dual licensed under the MIT and GPLv3 licenses.
** https://github.com/okfn/annotator/blob/master/LICENSE
**
** Built at: 2014-04-11 02:53:40Z
*/
!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self);var n=e;n=n.Annotator||(n.Annotator={}),n=n.Plugin||(n.Plugin={}),n.Permissions=t()}}(function(){return function t(e,n,i){function o(s,u){if(!n[s]){if(!e[s]){var d="function"==typeof require&&require;if(!u&&d)return d(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+s+"'")}var a=n[s]={exports:{}};e[s][0].call(a.exports,function(t){var n=e[s][1][t];return o(n?n:t)},a,a.exports,t,e,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({"4hR4NO":[function(t,e){(function(t){var n,i,o;if("undefined"!=typeof i&&null!==i&&(i=i),"undefined"!=typeof t&&null!==t&&null==i&&(i=t),"undefined"!=typeof window&&null!==window&&null==i&&(i=window),n=null!=i?i.Annotator:void 0,null==n&&(n=(null!=i?null!=(o=i.define)?o.amd:void 0:void 0)?null!=i?i.require("annotator"):void 0:void 0),"function"!=typeof n)throw new Error("Could not find Annotator! In a webpage context, please ensure that the Annotator script tag is loaded before any plugins.");e.exports=n}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],annotator:[function(t,e){e.exports=t("4hR4NO")},{}],3:[function(t,e){var n,i,o,r,s=function(t,e){return function(){return t.apply(e,arguments)}},u={}.hasOwnProperty,d=function(t,e){function n(){this.constructor=t}for(var i in e)u.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=t("annotator"),n=i.Util.$,r=i.Util.TranslationString,o=function(t){function e(){this._setAuthFromToken=s(this._setAuthFromToken,this),this.updateViewer=s(this.updateViewer,this),this.updateAnnotationPermissions=s(this.updateAnnotationPermissions,this),this.updatePermissionsField=s(this.updatePermissionsField,this),this.addFieldsToAnnotation=s(this.addFieldsToAnnotation,this),e.__super__.constructor.apply(this,arguments),this.options.user&&(this.setUser(this.options.user),delete this.options.user)}return d(e,t),e.prototype.options={showViewPermissionsCheckbox:!0,showEditPermissionsCheckbox:!0,userId:function(t){return t},userString:function(t){return t},userAuthorize:function(t,e,n){var i,o,r,s;if(e.permissions){if(o=e.permissions[t]||[],0===o.length)return!0;for(r=0,s=o.length;s>r;r++)if(i=o[r],this.userId(n)===i)return!0;return!1}return e.user?n?this.userId(n)===this.userId(e.user):!1:!0},user:"",permissions:{read:[],update:[],"delete":[],admin:[]}},e.prototype.pluginInit=function(){var t,e;if(i.supported())return this.annotator.subscribe("beforeAnnotationCreated",this.addFieldsToAnnotation),e=this,t=function(t,n){return function(i,o){return e[t].call(e,n,i,o)}},!this.user&&this.annotator.plugins.Auth&&this.annotator.plugins.Auth.withToken(this._setAuthFromToken),this.options.showViewPermissionsCheckbox===!0&&this.annotator.editor.addField({type:"checkbox",label:r("Allow anyone to <strong>view</strong> this annotation"),load:t("updatePermissionsField","read"),submit:t("updateAnnotationPermissions","read")}),this.options.showEditPermissionsCheckbox===!0&&this.annotator.editor.addField({type:"checkbox",label:r("Allow anyone to <strong>edit</strong> this annotation"),load:t("updatePermissionsField","update"),submit:t("updateAnnotationPermissions","update")}),this.annotator.viewer.addField({load:this.updateViewer}),this.annotator.plugins.Filter?this.annotator.plugins.Filter.addFilter({label:r("User"),property:"user",isFiltered:function(t){return function(e,n){var i,o,r,s;if(n=t.options.userString(n),!e||!n)return!1;for(s=e.split(/\s*/),o=0,r=s.length;r>o;o++)if(i=s[o],-1===n.indexOf(i))return!1;return!0}}(this)}):void 0},e.prototype.setUser=function(t){return this.user=t},e.prototype.addFieldsToAnnotation=function(t){return t&&(t.permissions=this.options.permissions,this.user)?t.user=this.user:void 0},e.prototype.authorize=function(t,e,n){return void 0===n&&(n=this.user),this.options.userAuthorize?this.options.userAuthorize.call(this.options,t,e,n):!0},e.prototype.updatePermissionsField=function(t,e,i){var o;return e=n(e).show(),o=e.find("input").removeAttr("disabled"),this.authorize("admin",i)||e.hide(),this.authorize(t,i||{},null)?o.attr("checked","checked"):o.removeAttr("checked")},e.prototype.updateAnnotationPermissions=function(t,e,i){var o;return i.permissions||(i.permissions=this.options.permissions),o=t+"-permissions",i.permissions[t]=n(e).find("input").is(":checked")?[]:[this.options.userId(this.user)]},e.prototype.updateViewer=function(t,e,o){var r,s;return t=n(t),s=this.options.userString(e.user),e.user&&s&&"string"==typeof s?(r=i.Util.escape(this.options.userString(e.user)),t.html(r).addClass("annotator-user")):t.remove(),o&&(this.authorize("update",e)||o.hideEdit(),!this.authorize("delete",e))?o.hideDelete():void 0},e.prototype._setAuthFromToken=function(t){return this.setUser(t.userId)},e}(i.Plugin),i.Plugin.register("Permissions",o),e.exports=o},{}]},{},[3])(3)});
//# sourceMappingURL=annotator.permissions.min.js.map